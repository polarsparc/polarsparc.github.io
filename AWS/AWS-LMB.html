<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="AWS Lambda - Quick Notes">
    <meta name="subject" content="AWS Lambda - Quick Notes">
    <meta name="keywords" content="aws, cloud">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>AWS Lambda - Quick Notes</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br/>
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>AWS Lambda - Quick Notes</p>
    </div>
    <br />
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">01/03/2024</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" />
    <br/>
    <div id="section-div">
      <p>AWS Lambda</p>
    </div>
    <div id="para-div">
      <p>AWS <span class="hi-yellow">Lambda</span> is a fully managed serverless compute service that lets one can run code without
        provisioning or managing underlying infrastructure.</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of Lambda:</p>
      <ul id="blue-sqr-ul">
        <li><p>Can be used in event-driven architectures to execute code based on triggers</p></li>
        <li><p>Triggers come from event sources such as the CLI, API, SDK, or other AWS services</p></li>
        <li><p>Triggers can invoke a piece of code referred to as a <span class="hi-vanila">Lambda Function</span></p></li>
        <li><p>An <span class="hi-vanila">Event</span> is a JSON-formatted document that contains data for a Lambda function to
          process</p></li>
        <li><p>Lambda functions are for short code executions (upto <span class="hi-red">15</span> mins)</p></li>
        <li><p>Support programming languages for Lambda functions - Node.js, Python, Java (8 and above), C# (.Net Core), PowerShell,
          Golang, Ruby</p></li>
        <li><p>Once a Lambda function is created using a programming language, one can configure it to respond to events from any
          event source</p></li>
        <li><p>An application code must be organized into Lambda functions and the Lambda service runs the Lambda functions on-demand
          only when needed and scales automatically</p></li>
        <li><p>Lambda functions execute concurrently (in parallel) based on the incoming events</p></li>
        <li><p>If one reaches a concurrency limit (based on a Region), then Lambda throttles the execution with a <span class=
          "hi-grey">TooManyRequestsException</span> error</p></li>
        <li><p>One must ensure the Lambda function has the appropriate IAM permissions to perform its task</p></li>
        <li>
          <p>The Lambda function invocation can be in one of the following modes:</p>
          <div id="step-div">
            <p>Synchronous</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Can be invoked from CLI, SDK, or API</p></li>
            <li><p>The code execution will wait for the function to process the event and return a response</p></li>
            <li><p>Error handling on the client side (via retries)</p></li>
          </ul>
          <div id="step-div">
            <p>Asynchronous</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Can be invoked through events from S3, SNS, SQS, CloudWatch, etc</p></li>
            <li><p>Each event is queued for processing and a response is return immediately on processing</p></li>
            <li><p>Lambda will retry up to <span class="hi-red">3</span> times on errors</p></li>
            <li><p>Processing <span class="underbold">MUST</span> be idempotent</p></li>
          </ul>
          <div id="step-div">
            <p>Event Source Mapping</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Can be invoked through events from SQS, DynamoDB Streams, Kinesis Data Streams, etc</p></li>
            <li><p>Lambda <span class="underbold">POLLS</span> for events from the event sources</p></li>
            <li><p>Events gets processed in order (except for SQS Standard)</p></li>
          </ul>
        </li>
        <li><p>One pays <span class="underbold">ONLY</span> for the compute usage (in millisecs) and there is <span class="underbold">
          NO</span> charge when the code is NOT running</p></li>
        <li>
          <p>Pay per request call has the following features:</p>
          <ul id="blue-arw-ul">
            <li><p>First <span class="hi-red">1</span>M requests are <span class="underbold">FREE</span></p></li>
            <li><p><span class="hi-green">$0.20</span> per 1M requests thereafter</p></li>
          </ul>
        </li>
        <li>
          <p>Pay per duration of compute (in increment of 1 ms) has the following features:</p>
          <ul id="blue-arw-ul">
            <li><p>First <span class="hi-red">400</span>K GB-seconds of compute (with 1GB RAM) time per month <span class="underbold">
              FREE</span></p></li>
            <li><p>Pay <span class="hi-green">$1.00</span> for <span class="hi-red">600</span>K GB-seconds thereafter</span></p></li>
          </ul>
        </li>
        <li><p>One can provision more memory (RAM) to a Lambda function (upto <span class="hi-red">10</span>GB)</p></li>
        <li><p>Increasing RAM implicitly increases the CPU and Network performance and costs more</p></li>
        <li><p>One can deploy the code and its dependencies for the Lambda function using a deployment package, which can be a zip
          file archive or a container image</p></li>
        <li><p>The execution environment provides a secure and isolated runtime environment for the Lambda function</p></li>
        <li><p>The execution environment manages the processes and resources that are required to run the Lambda function</p></li>
        <li><p>AWS Lambda integrates with a whole range of AWS services</p></li>
        <li><p>Monitoring is through CloudWatch Logs</p></li>
        <li><p>Use-cases: data processing, real-time file processing, real-time stream processing, serverless backends for mobile,
          web applications</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>Lambda Limits</p>
    </div>
    <div id="para-div">
      <p>The limits are per Region and as follows:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="bold">Execution Limits</span></p>
          <ul id="blue-arw-ul">
            <li><p>Memory allocation - 128 MB to 10 GB (in 1 MB increments)</p></li>
            <li><p>Maximum execution time - 900 seconds (15 mins)</span></p></li>
            <li><p>Size of Environment variables - upto 4 KB</span></p></li>
            <li><p>Disk capacity in the Lambda finction container (access at /tmp) - 512 KB to 10 GB</span></p></li>
            <li><p>Concurrent executions - upto 1000 (can be increased)</span></p></li>
            <li><p>Default timeout - 3 secs</span></p></li>
          </ul>
        </li>
        <li>
          <p><span class="bold">Deployment Limits</span></p>
          <ul id="blue-arw-ul">
            <li><p>Maximum size of the zip file archive - 50 MB</p></li>
            <li><p>Use the /tmp directory to load other files at startup</p></li>
            <li><p>Size of Environment variables - upto 4 KB</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>Lambda SnapStart</p>
    </div>
    <div id="para-div">
      <p>The following are some features of Lambda SnapStart:</p>
      <ul id="blue-sqr-ul">
        <li><p>Improves the Lambda function performance up to 10x (at no extra cost) for Java 11 and above</p></li>
        <li><p>Without SnapStart, a java Lambda function goes through few invocation lifecycle phases: Init -> Invoke -> Shutdown</p></li>
        <li><p>With SnapStart enabled, a java Lambda function is invoked from a pre-initialized state (no Init from scratch): Invoke
          -> Shutdown</p></li>
        <li><p>The Lambda runtime takes a snapshot of the memory and disk state of the initialized function and caches the snapshot
          for low-latency access</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>Lambda@Edge and CloudFront Functions</p>
    </div>
    <div id="para-div">
      <p>Sometimes applications deployed at the edge have a need to execute some form of logic before reaching the application. These
        are the customer written code that can be attached to CloudFront and run close to the users to minimize latency.</p>
      <p>The following are the two options:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="bold">CloudFront Functions</span></p>
          <ul id="blue-arw-ul">
            <li><p>Are lightweight function written in JavaScript for modifying the viewer request to CloudFront and the viewer
              response from CloudFront</p></li>
            <li><p>For high-scale, latency sensitive CDN customizations</span></p></li>
            <li><p>Sub millisec startup time and handle millions of requests per sec</span></p></li>
            <li><p>Native feature of CloudFront and managed within CloudFront</span></p></li>
            <li><p>Maximum execution time must be less than 1 ms</span></p></li>
            <li><p>Maximum memory allocated is 2 MB</span></p></li>
            <li><p>Useful for cache key transformation (headers, cookies, query strings), header manipulation, URL rewrites or redirects,
              Validate JWT tokens</span></p></li>
          </ul>
        </li>
        <li>
          <p><span class="bold">Lambda@Edge</span></p>
          <ul id="blue-arw-ul">
            <li><p>For code written in Node.js or Python and can do much more than just manipulation of the viewer request and viewer
              response</p></li>
            <li><p>Scales to 1000s of requests per sec</p></li>
            <li><p>Can manipulate viewer request, origin request, origin response, and viewer response</p></li>
            <li><p>Deploy functions in one Region (us-east-1) and CloudFront replicates it to all the other locations</p></li>
            <li><p>Maximum execution time must be between 5 to 10 secs</p></li>
            <li><p>Maximum memory allocated is in the range of 128 MB to 10 GB</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>Lambda in VPC</p>
    </div>
    <div id="para-div">
      <p>The following are some features of Lambda in VPC:</p>
      <ul id="blue-sqr-ul">
        <li><p>By default, a Lambda function is launched outside of a customer created VPC (in AWS owned VPC) and therefore cannot
          access resources in the custom VPC</p></li>
        <li><p>One can configure a Lambda function to run in a custom VPC by providing the VPC ID, the subnets to use, and attach
          the Security Groups</p></li>
        <li><p>If configured run in a custom VPC, it will create an Elastic Network Interface (ENI) in the custom VPC subnets which
          allows access to other resources in the VPC</p></li>
        <li><p>One use-case is for using RDS Proxy with Lambda in VPC is to manage too many open connections to the RDS database.
          Note that RDS Proxy is never publicly accessible and hence the Lambda functions needs to be in the VPC</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>Lambda from RDS</p>
    </div>
    <div id="para-div">
      <p>The following are some features of Lambda from RDS:</p>
      <ul id="blue-sqr-ul">
        <li><p>Can invoke Lambda function from within RDS database instance</p></li>
        <li><p>Allows one to process data events from within a database</p></li>
        <li><p>Supported on RDS for PostgreSQL and Aurora MySQL</p></li>
        <li><p>Must be configured in the database</p></li>
        <li><p>Must allow outbound traffic to the Lambda function from within the database (using NAT GW, VPC Endpoint)</p></li>
        <li><p>The database must have the required permissions to invoke the Lambda function (via IAM Policy or Lambda Resource-based
          Policy)</p></li>
      </ul>
    </div>
    <br/>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" target="_blank"><span class="bold">Official AWS Lambda Documentation</span></a></p>
    </div>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
