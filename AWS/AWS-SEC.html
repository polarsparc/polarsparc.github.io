<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="AWS Security - Quick Notes">
    <meta name="subject" content="AWS Security - Quick Notes">
    <meta name="keywords" content="aws, cloud">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>AWS Security - Quick Notes</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br/>
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>AWS Security - Quick Notes</p>
    </div>
    <br />
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">01/17/2024</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" />
    <br/>
    <div id="section-div">
      <p>AWS Directory Service</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Directory Service</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Provides multiple ways to use <span class="bold">Microsoft Active Directory</span> (AD) with other AWS services such
          as EC2, RDS for SQL Server, FSx for Windows File Server, and IAM Identity Center</p></li>
        <li><p>Directories store information about users, groups, and devices, which can be used to manage access to information and
          resources</p></li>
        <li>
          <p>The following are the three different choices:</p>
          <div id="step-div">
            <p>AWS Managed Microsoft AD</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>A managed service for AD that is powered by <span class="bold">Windows Server</span></p></li>
            <li><p>Highly available pair of <span class="bold">Domain Controllers</span> connected to the customer VPC</p></li>
            <li><p>The Domain Controllers run in different availability zones in a Region</p></li>
            <li><p>Host monitoring, recovery, replication, snapshots, and software updates are automatically configured and managed</p></li>
            <li><p>One can also configure a <span class="bold">Trust Relationship</span> with the customers existing on-prem AD</p></li>
            <li><p>Integration with on-prem needs a <span class="bold">VPN</span> or <span class="bold">Direct Connect</span> connection</p></li>
            <li><p>The trust relationship with on-prem provides users and groups with access to resources in either domain using
              single sign-on</p></li>
            <li><p>Enables authentication and authorization for many AWS services, such as, Management Console, RDS, QuickSight,
              WorkDocs, Workmail, Workspaces, etc</p></li>
            <li><p>Best choice if there are more than <span class="hi-red">5000</span> users</p></li>
            <li><p>One can also enable MFA with RADIUS</p></li>
          </ul>
          <div id="step-div">
            <p>AD Connector</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Is a proxy service that provides an easy way to connect a customers existing on-prem AD to AWS</p></li>
            <li><p>Integration with on-prem needs a <span class="bold">VPN</span> or <span class="bold">Direct Connect</span> connection</p></li>
            <li><p>Allows one to map AD identities to IAM roles</p></li>
            <li><p>Redirects directory request to the on-prem AD</p></li>
            <li><p>Enables authentication and authorization for compatible AWS services, such as, EC2 for Windows Server, Management Console,
              QuickSight, WorkDocs, Workmail, Workspaces, etc</p></li>
            <li><p>Best choice if one wants to use an existing on-prem AD</p></li>
          </ul>
          <div id="step-div">
            <p>Simple AD</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Is an AD-compatible directory that is powered by <span class="bold">Samba 4</span></p></li>
            <li><p>Supports basic AD features such as user accounts, group memberships, joining a Linux domain or Windows based EC2
              instances</p></li>
            <li><p>Provides support for Kerberos-based single sign-on (SSO)</p></li>
            <li><p>A fully managed, standalone directory in the AWS cloud</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>Amazon Cognito</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Cognito</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Is a user directory for web and mobile app authentication and authorization</p></li>
        <li><p>Is an <span class="bold">OpenID Connect</span> (OIDC) identity provider (IdP)</p></li>
        <li><p>Supported authentication using OAuth, OIDC, SAML</p></li>
        <li>
          <p>The following are the two important entities within Cognito:</p>
          <div id="step-div">
            <p>Cognito User Pool</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Allows one to easily and securely add sign-up and sign-in functionality for apps</p></li>
            <li><p>Supports a user directory for storing users identity </p></li>
            <li><p>Support for federated identity with external authentication providers such as Facebook, Google, etc</p></li>
            <li><p>Support for Multi-Factor authentication (MFA)</p></li>
          </ul>
          <div id="step-div">
            <p>Cognito Identity Pool</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Allows apps to get temporary credentials that grant users access to specific AWS resources</p></li>
            <li><p>Integrates with Cognito User Pool</p></li>
            <li><p>IAM Policies to be applied for the credentials are defined in Cognito</p></li>
            <li><p>IAM Policies can be customized based on the user identity for fine-grained control</p></li>
            <li><p>Can also have default IAM Roles which can be used if there are no defined IAM Policies</p></li>
          </ul>
        </li>
        <li><p>Users are authenticated by the Cognito User Pool to get a JWT token, which is then used by Cognito Identity Pool to
          map to am IAM role for temporary access</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Key Management Service (KMS)</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Key Management Service</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Is a managed service that makes it easy for one to create and control the cryptographic keys that are used to encrypt
          and decrypt data</p></li>
        <li><p>Uses <span class="bold">Hardware Security Module</span> (HSM) to protect and validate the AWS KMS keys</p></li>
        <li><p>Fully integrated with IAM for authorization</p></li>
        <li><p>Is <span class="underbold">SCOPED</span> to a Region</p></li>
        <li><p>One can audit KMS key usage using <span class="bold">CloudTrail</span></p></li>
        <li><p>Integrates seemlessly with most AWS services (S3, RDS, etc)</p></li>
        <li><p>KMS keys can be <span class="bold">Symmetric</span> or <span class="bold">Asymmetric</span></p></li>
        <div id="step-div">
          <p>Symmetric Key</p>
        </div>
        <ul id="blue-arw-ul">
          <li><p>Uses AES-256</p></li>
          <li><p>Same key for both encryption and decryption</p></li>
          <li><p>All AWS services integrated with KMS use this type</p></li>
          <li><p>Users <span class="underbold">NEVER</span> get access to the key</p></li>
        </ul>
        <div id="step-div">
          <p>Asymmetric Key</p>
        </div>
        <ul id="blue-arw-ul">
          <li><p>Uses Elliptic Curve (ECC) or RSA key pairs - public and private</p></li>
          <li><p>Public key to encrypt and private key to decypt</p></li>
          <li><p>Public key can be downloaded, while the private key <span class="underbold">CANNOT</span> be accessed</p></li>
        </ul>
        <li><p><span class="hi-vanila">AWS Owned Keys</span> are free to use. Examples include SSE-S3, SSE-SQS, SSE-DDB. Users have
          <span class="underbold">NO</span> control</p></li>
        <li><p><span class="hi-vanila">AWS Managed Keys</span> are free to use. Examples include aws/rds, aws/ebs, aws/dynamodb</p></li>
        <li><p><span class="hi-vanila">Customer Managed Keys</span> costs <span class="hi-red">$ 1.00</span> per month</p></li>
        <li><p>API calls to KMS cost <span class="hi-red">$ 0.03</span> per 10000 calls</p></li>
        <li><p>Support for automatic key rotation of AWS managed keys every 1 year</p></li>
        <li><p>Support for automatic key rotation of Customer managed keys <span class="underbold">MUST</span> be enabled and will
          be every 1 year</p></li>
        <li><p>KMS Key Policies allows one to control access to KME keys (similar to S3 bucket policies)</p></li>
        <li><p>Default KMS key policy allows every user in an AWS account access</p></li>
        <li><p>Custom KMS key policy can be used for cross-account access</p></li>
        <li><p>To limit the keys for specific resources, use the <span class="hi-grey">kms:ViaService</span> condition in policy</p></li>
        <li>
          <p>KMS Multi-Region Keys</p>
          <ul id="blue-arw-ul">
            <li><p>KMS primary key from a region is replicated to other Regions</p></li>
            <li><p>Identical keys in different Regions so that one can encrypt in one Region and decrypt in another Region</p></li>
            <li><p>Has the same key ID, same key material, and automatic rotation</p></li>
            <li><p>Useful for global client-side encryption, encrypting specific data attributes on client side before storing in
              global dynamodb or global aurora</p></li>
          </ul>
        </li>
        <li>
          <p>Sharing Encrypted AMI</p>
          <ul id="blue-arw-ul">
            <li><p>Modify the image attribute to add a <span class="hi-grey">Launch Permission</span> corresponding to the target
              AWS account</p></li>
            <li><p>Share the KMS key with the target AWS account via key policy</p></li>
            <li><p>Ensure the IAM user/role in the target AWS account has the appropriate permissions</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Systems Manager Parameter Store</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Parameter Store</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Also referred to as <span class="hi-vanila">SSM Parameter Store</span></p></li>
        <li><p>Provides secure, <span class="underbold">hierarchical</span> storage for configuration data and secrets management</p></li>
        <li><p>Highly scalable, available, and durable</p></li>
        <li><p>One can store configuration data such as passwords, database urls, and license codes as parameter values</p></li>
        <li><p>Parameter values can be stored either as plain text or encrypted data</p></li>
        <li><p>One can reference the parameters in scripts, commands, and configuration and automation workflows by using the unique
          name that was specified when the parameter was created</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Secrets Manager</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Secrets Manager</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Helps one manage, retrieve, and rotate database credentials, application credentials, OAuth tokens, API keys, and
          other secrets throughout their lifecycles</p></li>
        <li><p>Many of the AWS services store and use secrets in the Secrets Manager</p></li>
        <li><p>One can configure an automatic rotation schedule for the secrets, which will use a AWS Lambda function to update the
          secret</p></li>
        <li><p>Integrated with RDS, Aurora, Redshift, DocumentDB for secrets management</p></li>
        <li><p>Multi-Region secrets means the primary secret in a Region is replicated to other Regions (replica) and kept in sync</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Certificate Manager (ACM)</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of the <span class="hi-yellow">Certificate Manager</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Helps one create, store, manage, and renew publicly trusted SSL/TLS certificates that protect secure websites and
          applications</p></li>
        <li><p>Support for both public and private SSL/TLS certificates</p></li>
        <li><p>Public certificates are signed by the AWS public Certificate Authority (CA)</p></li>
        <li><p>One can create their own private CA in ACM</p></li>
        <li><p>Support for automatic renewal of SSL/TLS certificates</p></li>
        <li><p>Integration with Elastic Load Balancers (ELB), CloudFront distributions, API Gateway, Elastic Beanstalk</p></li>
        <li><p><span class="underbold">CANNOT</span> be used with EC2 Instances</p></li>
        <li><p>One can also import a public SSL/TLS certificate created externally, but will not have the automatic renewal feature</p></li>
        <li>
          <p>On can request a public SSL/TLS certificate</p>
          <ul id="blue-arw-ul">
            <li><p>List single or multiple domain names including wildcards (fully qualified like api.example.com as well as wildcard
              *.example.com)</p></li>
            <li><p>Select the validation method - DNS (preferred) or Email</p></li>
            <li><p>For DNS validation will need a CNAME record</p></li>
            <li><p>Must setup a CNAME or an Alias in Route 53</p></li>
            <li><p>After validation (takes few hours), the public certificate will be setup with automatic renewal (60 days before
              expiry)</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Web Application Firewall (WAF)</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Web Application Firewall</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Allows one to protect web applications (Layer 7) from common exploits (SQL
          Injection, Cross-Site Scripting)</p></li>
        <li><p>One can protect resources such as CloudFront distributions, API Gateway, Application Load Balancer (ALB), Cognito
          User Pool, Async GraphQL API</p></li>
        <li>
          <p>One needs to define a Web Access Control List (Web ACL) to protect web resources and can be based on</p>
          <ul id="blue-arw-ul">
            <li><p>Geo-location - country of origin</p></li>
            <li><p>IP Set - based on IP addresses (upto 10000 IP addresses)</p></li>
            <li><p>HTTP headers, body, or URI string</p></li>
            <li><p>Request size constraints</p></li>
            <li><p>Rate based rules (max request per sec - for DDoS protection)</p></li>
          </ul>
        </li>
        <li><p>Web ACL are <span class="underbold">REGIONAL</span> except for CloudFront</p></li>
        <li><p>Each Rule contains a statement that defines the inspection criteria and an action to take if the criteria is met</p></li>
        <li><p>A Rule Group is a reusable set of rules one can add to a Web ACL</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Shield</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Shield</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Provides protection against Distributed Denial of Service (DDoS) attacks for AWS resources, at the network and transport
          layers (layer 3 and 4) and the application layer (layer 7)</p></li>
        <li>
          <p>The following are the two levels of protection against DDoS attacks:</p>
          <div id="step-div">
            <p>AWS Shield Standard</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Free service that is activated for all AWS customers</p></li>
            <li><p>Protection from SYN/UPD flooding, Reflection attack, and other Layer 3/4 attacks</p></li>
          </ul>
          <div id="step-div">
            <p>AWS Shield Advanced</p>
          </div>
          <ul id="blue-arw-ul">
            <li><p>Optional DDoS mitigation service - costs <span class="hi-red">$ 3000</span> per month for 1 year commitment per
              organization</p></li>
            <li><p>Protection from more sophisticated attacks on EC2, ELB, CloudFront, Global Accelerator, and Route 53</p></li>
            <li><p>24/7 access to AWS DDoS response team</p></li>
            <li><p>Automatically creates, evaluates, and deploys AWS WAF rules to mitigate Layer 7 attacks</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Firewall Manager</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Firewall Manager</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Simplifies the administration and maintenance of rules across all the accounts and resources of an AWS organization</p></li>
        <li><p>Can set the security policy (a common set of security rules) for a variety of protections, including WAF, Shield
          Advanced, Security Groups for resources in VPC, AWS Network Firewall, and Amazon Route 53 Resolver DNS Firewall</p></li>
        <li><p>Policies/Rules created at a Region level</p></li>
        <li><p>One needs to set up the protections just once and the service automatically applies them across all accounts and
          resources, <span class="underbold">EVEN</span> for future new accounts and resources</p></li>
        <li><p>Costs <span class="hi-red">$ 100</span> per month for the service</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS GuardDuty</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">GuardDuty</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Is an intelligent and continuous security monitoring service that can help identify unexpected and potentially
          unauthorized or malicious activity in an AWS account</p></li>
        <li><p>It uses threat intelligence feeds, such as lists of malicious IP addresses and domains, and machine learning to
          identify malicious activity</p></li>
        <li><p>Processes events from various sources, such as, CloudTrail, VPC flow logs, DNS logs, RDS login activity, S3 logs,
          EBS volumes, EKS logs, Lambda network activity, etc</p></li>
        <li><p>One can setup EventBridge rules to notify in case of any findings</p></li>
        <li><p>Can detect compromised EC2 instances and container workloads that are used for Crypto mining</p></li>
        <li><p>If the service is <span class="underbold">DISABLED</span>, it deletes all the data (findings, config) related to
          the service</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Inspector</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Inspector</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Is an automated security vulnerability assessment service that helps improve the security and compliance of the AWS
          resources</p></li>
        <li><p>Can be configured to run on a schedule</p></li>
        <li><p>Automatically assesses resources for vulnerabilities or deviations from best practices, and then produces a detailed
          list of security findings prioritized by level of severity</p></li>
        <li><p>Automatically discovers and scans running EC2 instances, container images in Elastic Container Registry (ECR), and
          Lambda functions for known software vulnerabilities and unintended network exposure</p></li>
        <li><p>The findings are sent to the AWS Security Hub, which provides a comprehensive view of the security state in AWS
          environment</p></li>
      </ul>
    </div>
    <div id="section-div">
      <p>AWS Macie</p>
    </div>
    <div id="para-div">
      <p>The following is the summary of the various features/capabilities of <span class="hi-yellow">Macie</span>:</p>
      <ul id="blue-sqr-ul">
        <li><p>Is a fully managed data security and data privacy service that uses machine learning and pattern matching to discover
          and protect against sensitive data stored in S3</p></li>
        <li><p>Can alert against Personally Identifiable Information (PII), Protected Health Information (PHI), API keys, secret keys,
          etc</p></li>
      </ul>
    </div>
    <br/>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/what_is.html" target="_blank"><span class="bold">Official AWS Directory Service Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html" target="_blank"><span class="bold">Official Amazon Cognito Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/kms/latest/developerguide/overview.html" target="_blank"><span class="bold">Official AWS Key Management Service Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank"><span class="bold">Official AWS SSM Parameter Store Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html" target="_blank"><span class="bold">Official AWS Secrets Manager Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html" target="_blank"><span class="bold">Official AWS Certificate Manager Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-chapter.html" target="_blank"><span class="bold">Official AWS Web Application Firewall Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/waf/latest/developerguide/shield-chapter.html" target="_blank"><span class="bold">Official AWS Shield Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html" target="_blank"><span class="bold">Official AWS Firewall Manager Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html" target="_blank"><span class="bold">Official AWS GuardDuty Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html" target="_blank"><span class="bold">Official AWS Inspector Documentation</span></a></p>
      <p><a href="https://docs.aws.amazon.com/macie/latest/user/what-is-macie.html" target="_blank"><span class="bold">Official AWS Macie Documentation</span></a></p>
    </div>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
