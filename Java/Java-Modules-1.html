<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1252">
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="Introduction to the Java Platform Module System - Part 1">
    <meta name="subject" content="Introduction to the Java Platform Module System - Part 1">
    <meta name="keywords" content="java">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>Introduction to the Java Platform Module System - Part 1</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br>
    <table borber="0">
      <tbody><tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </tbody></table>
    <br>
    <div id="title-div">
      <p>Introduction to the Java Platform Module System - Part 1</p>
    </div>
    <br>
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">05/29/2020</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr">
    <br>
    <div id="para-div">
      <p>The <span class="hi-yellow">Java</span> Development Kit (<span class="bold">JDK</span>) was first released in the
        year 1995 and has evolved since then. All the packages and classes of the <span class="bold">Java</span> runtime
        are bundled into one big uber <span class="bold">JAR</span> file called <span class="hi-blue">rt.jar</span>. As
        with any monolith, it becames challenging to develop, maintain, refactor, secure, and/or evolve over time.</p>
      <p>Between classes, <span class="bold">Java</span> implements good encapsulation mechanism using the visibility
        modifiers such as <span class="hi-yellow">public</span>, <span class="hi-yellow">protected</span>,
        <span class="hi-yellow">private</span>, etc.</p>
      <p>On the other hand, <span class="bold">Java</span> packages implement a weak encapsulation mechanism - all public
        classes are visible to all other classes. There is no way to control this public visibility of claas(es) in a
        package. This implies, if a library developer implements some class(es) for their own internal use, there is no
        way to prevent an application developer from using those class(es). How many of us are guilty of using the classes
        <span class="hi-blue">sun.misc.BASE64Encoder</span> or <span class="hi-blue">sun.misc.BASE64Decoder</span> ???</p>
      <p>A <span class="bold">JAR</span> file is nothing more than an archive of one or more <span class="bold">Java</span>
        packages. Even though it may appear to be modular because each library is in its own <span class="bold">JAR</span>,
        there is no mechanism to indicate <span class="bold">JAR</span> dependencies. How many of us have run into the
        <span class="hi-blue">java.lang.ClassNotFoundException</span> issue because of missing <span class="bold">JAR</span>
        file(s) ??? Or worse yet, the presence of the same class in different <span class="bold">JAR</span> files - ever
        encounter the <span class="hi-blue">java.lang.NoSuchMethodError</span> issue ???</p>
      <p>What we were missing was a strong encapsulation mechanism around <span class="bold">Java</span> packages. This
        is exactly what the <span class="hi-yellow">Java Platform Module System</span> in the <span class="hi-yellow">Java
        9</span> release set out to address.</p>
    </div>
    <div id="para-div">
      <p><span class="hi-blue">Modules</span> are independent, deployable containers for <span class="bold">Java</span>
        package(s), with strong encapsulation mechanisms in place. Within a <span class="bold">module</span>, some packages
        are marked as available for external consumption, while others are strictly for internal use, which is enforced by
        <span class="bold">Java</span> at both the compile time and the run time. In addition, a <span class="bold">module
        </span> indicates the other <span class="bold">module</span>(s) it is dependent on.</p>
    </div>
    <div id="para-div">
      <p>The following diagram illustrates the typical list of files and directories from <span class="bold">Java 8</span>:</p>
      <div id="img-outer-div"> <img alt="Contents of Java 8" class="img-cls" src="./images/JPMS-1.png">
        <div class="img-cap">Figure.1</div>
      </div>
    </div>
    <div id="para-div">
      <p>The following diagram illustrates the contents of the directory <span class="bold">jre/lib</span> from
        <span class="bold">Java 8</span>:</p>
      <div id="img-outer-div"> <img alt="Contents of JRE/LIB" class="img-cls" src="./images/JPMS-2.png">
        <div class="img-cap">Figure.2</div>
      </div>
    </div>
    <div id="para-div">
      <p>Starting <span class="bold">Java 9</span>, the platform itself has been refactored into a set of <span class="bold">
        module</span>s. The module <span class="hi-blue">java.base</span> is at the heart of the <span class="bold">Java</span>
        platform and is the primordial module that exposes the fundamental and core <span class="bold">Java</span> language
        packages <span class="hi-yellow">java.lang</span> and <span class="hi-yellow">java.util</span>. It is the base parent
        <span class="bold">module</span> and does not depend on any other <span class="bold">module</span>. All the other
        <span class="bold">module</span>s in the <span class="bold">Java</span> platform implicitly depend on this core
        <span class="bold">module</span>.</p>
    </div>
    <div id="para-div">
      <p>The following diagram illustrates the typical list of files and directories from <span class="bold">Java 9</span> (or
        above):</p>
      <div id="img-outer-div"> <img alt="Contents of Java 9" class="img-cls" src="./images/JPMS-3.png">
        <div class="img-cap">Figure.3</div>
      </div>
    </div>
    <div id="para-div">
      <p>The following diagram illustrates the contents of the directory <span class="bold">jmods</span> (which contains all
        the platform <span class="bold">module</span>s) from <span class="bold">Java 9</span> (or above):</p>
      <div id="img-outer-div"> <img alt="Contents of JMODS" class="img-cls" src="./images/JPMS-4.png">
        <div class="img-cap">Figure.4</div>
      </div>
    </div>
    <div id="para-div">
      <p>The <span class="bold">Java</span> platform <span class="bold">module</span>s are divided into two categories:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="bold">Standard</span> :: <span class="bold">module</span>s with names that are prefixed with
            <span class="hi-blue">java.</span>. For example, <span class="hi-vanila">java.base</span>,
            <span class="hi-vanila">java.logging</span>, etc</p>
        </li>
        <li>
          <p><span class="bold">Non-Standard</span> :: <span class="bold">module</span>s with names that are prefixed with
            <span class="hi-blue">jdk.</span>. For example, <span class="hi-vanila">jdk.compiler</span>,
            <span class="hi-vanila">jdk.net</span>, etc. The <span class="bold">Java</span> packages from these
            <span class="bold">module</span>s are not part of the <span class="bold">Java</span> specification</p>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>To list all the <span class="bold">module</span>s provided with the <span class="bold">Java</span> platform, execute
        the following command using <span class="bold">Java 11</span>:</p>
    </div>
    <div id="cmd-div">
      <p>$ java --list-modules</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.1</h4>
      <pre>java.base@11.0.7
java.compiler@11.0.7
java.datatransfer@11.0.7
java.desktop@11.0.7
java.instrument@11.0.7
java.logging@11.0.7
java.management@11.0.7
java.management.rmi@11.0.7
java.naming@11.0.7
java.net.http@11.0.7
java.prefs@11.0.7
java.rmi@11.0.7
java.scripting@11.0.7
java.se@11.0.7
java.security.jgss@11.0.7
java.security.sasl@11.0.7
java.smartcardio@11.0.7
java.sql@11.0.7
java.sql.rowset@11.0.7
java.transaction.xa@11.0.7
java.xml@11.0.7
java.xml.crypto@11.0.7
jdk.accessibility@11.0.7
jdk.aot@11.0.7
jdk.attach@11.0.7
jdk.charsets@11.0.7
jdk.compiler@11.0.7
jdk.crypto.cryptoki@11.0.7
jdk.crypto.ec@11.0.7
jdk.dynalink@11.0.7
jdk.editpad@11.0.7
jdk.hotspot.agent@11.0.7
jdk.httpserver@11.0.7
jdk.internal.ed@11.0.7
jdk.internal.jvmstat@11.0.7
jdk.internal.le@11.0.7
jdk.internal.opt@11.0.7
jdk.internal.vm.ci@11.0.7
jdk.internal.vm.compiler@11.0.7
jdk.internal.vm.compiler.management@11.0.7
jdk.jartool@11.0.7
jdk.javadoc@11.0.7
jdk.jcmd@11.0.7
jdk.jconsole@11.0.7
jdk.jdeps@11.0.7
jdk.jdi@11.0.7
jdk.jdwp.agent@11.0.7
jdk.jfr@11.0.7
jdk.jlink@11.0.7
jdk.jshell@11.0.7
jdk.jsobject@11.0.7
jdk.jstatd@11.0.7
jdk.localedata@11.0.7
jdk.management@11.0.7
jdk.management.agent@11.0.7
jdk.management.jfr@11.0.7
jdk.naming.dns@11.0.7
jdk.naming.rmi@11.0.7
jdk.net@11.0.7
jdk.pack@11.0.7
jdk.rmic@11.0.7
jdk.scripting.nashorn@11.0.7
jdk.scripting.nashorn.shell@11.0.7
jdk.sctp@11.0.7
jdk.security.auth@11.0.7
jdk.security.jgss@11.0.7
jdk.unsupported@11.0.7
jdk.unsupported.desktop@11.0.7
jdk.xml.dom@11.0.7
jdk.zipfs@11.0.7</pre>
    </div>
    <div id="para-div">
      <p>The following illustration depicts the composition of a <span class="bold">module</span>:</p>
      <div id="img-outer-div"> <img alt="Java Module" class="img-cls" src="./images/JPMS-5.png">
        <div class="img-cap">Figure.5</div>
      </div>
    </div>
    <div id="para-div">
      <p>A <span class="bold">module</span> has a globally unique name associated with it along with the following elements:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="bold">exports</span> :: indicates the package(s) available for external access</p>
        </li>
        <li>
          <p><span class="bold">opens</span> :: indicates the package(s) available through reflective access</p>
        </li>
        <li>
          <p><span class="bold">provides</span> :: indicates the package(s) as implementation(s) of some service interface</p>
        </li>
        <li>
          <p><span class="bold">requires</span> :: indicates the <span class="bold">module</span>s it depends on</p>
        </li>
        <li>
          <p><span class="bold">uses</span> :: indicates the service interface(s) it leverages</p>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>To display all the information about the <span class="bold">Java</span> platform a <span class="bold">module</span>
        called <span class="hi-yellow">java.sql</span>, execute the following command using <span class="bold">Java 11</span>:</p>
    </div>
    <div id="cmd-div">
      <p>$ java --describe-module java.sql</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.2</h4>
      <pre>java.sql@11.0.7
exports java.sql
exports javax.sql
requires java.transaction.xa transitive
requires java.xml transitive
requires java.logging transitive
requires java.base mandated
uses java.sql.Driver</pre>
    </div>
    <div id="para-div">
      <p>We will now demonstrate the behavior of a simple <span class="bold">Java</span> program in both <span class="bold">Java
        8</span> and <span class="bold">Java 11</span>.</p>
    </div>
    <div id="para-div">
      <p>The following simple <span class="bold">Java</span> program <span class="hi-yellow">BASE64</span> encodes a string of
        characters:</p>
    </div>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.1</div>
      <div class="src-body-1">
      <pre>package com.polarsparc.jm;

import sun.misc.BASE64Encoder;

public class MyB64Enc {
    public static void main(String[] args) {
        byte[] secret = "MySup3rS3cr3t#".getBytes();
        
        BASE64Encoder encoder = new BASE64Encoder();
        
        System.out.printf("Encoded secret: %s\n", encoder.encode(secret));
    }
}</pre>
      </div>
    </div>
    <div id="para-div">
      <p>To compile the above <span class="bold">Java</span> program using the <span class="bold">Java 8</span> compiler, execute
        the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ javac com/polarsparc/jm/MyB64Enc.java</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.3</h4>
      <pre>com/polarsparc/jm/MyB64Enc.java:4: warning: BASE64Encoder is internal proprietary API and may be removed in a future release
import sun.misc.BASE64Encoder;
               ^
com/polarsparc/jm/MyB64Enc.java:10: warning: BASE64Encoder is internal proprietary API and may be removed in a future release
        BASE64Encoder encoder = new BASE64Encoder();
        ^
com/polarsparc/jm/MyB64Enc.java:10: warning: BASE64Encoder is internal proprietary API and may be removed in a future release
        BASE64Encoder encoder = new BASE64Encoder();
                                    ^
3 warnings</pre>
    </div>
    <br>
    <div id="warn-div">
      <h4>&#9940; ATTENTION &#9940;</h4>
      <pre>Always <span class="underbold">PAY</span> attention to the *<span class="bold">warning</span>s*.</pre>
    </div>
    <div id="para-div">
      <p>To execute the compiled <span class="bold">Java</span> program using the <span class="bold">Java 8</span> compiler, execute
        the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ java com/polarsparc/jm/MyB64Enc</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.4</h4>
      <pre>Encoded secret: TXlTdXAzclMzY3IzdCM=</pre>
    </div>
    <div id="para-div">
      <p>Now let us try to run the same <span class="bold">Java</span> program using the <span class="bold">Java 11</span> compiler
        by executing the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ java com/polarsparc/jm/MyB64Enc</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.5</h4>
      <pre>Exception in thread "main" java.lang.NoClassDefFoundError: sun/misc/BASE64Encoder
	at com.polarsparc.jm.MyB64Enc.main(MyB64Enc.java:10)
Caused by: java.lang.ClassNotFoundException: sun.misc.BASE64Encoder
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)
	... 1 more</pre>
    </div>
    <div id="para-div">
      <p>We will use the dependency analyzer utility program called <span class="hi-blue">jdeps</span> provided with
        <span class="bold">Java 11</span> to analyze and understand the <span class="bold">Java</span> package or class
        level dependencies. To do that, execute the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ jdeps --jdk-internals --class-path ./com/polarsparc/jm</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.6</h4>
      <pre>jm -&gt; JDK removed internal API
   com.polarsparc.jm.MyB64Enc          -&gt; sun.misc.BASE64Encoder          JDK internal API (JDK removed internal API)

Warning: JDK internal APIs are unsupported and private to JDK implementation that are
subject to be removed or changed incompatibly and could break your application.
Please modify your code to eliminate dependence on any JDK internal APIs.
For the most recent update on JDK internal API replacements, please check:
https://wiki.openjdk.java.net/display/JDK8/Java+Dependency+Analysis+Tool

JDK Internal API                         Suggested Replacement
----------------                         ---------------------
sun.misc.BASE64Encoder                   Use java.util.Base64 @since 1.8</pre>
    </div>
    <div id="para-div">
      <p>From the Output.6 above, it is clear that the internal class <span class="hi-yellow">sun.misc.BASE64Encoder</span>
        has been removed and the recommendation is to use the class <span class="hi-yellow">java.util.Base64</span>.</p>
    </div>
    <div id="para-div">
      <p>The following is the fixed <span class="bold">Java</span> program that uses the recommended approach for
        <span class="bold">BASE64</span> encoding a string of characters that works in both <span class="bold">Java 8</span>
        and <span class="bold">Java 11</span>:</p>
    </div>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.2</div>
      <div class="src-body-1">
      <pre>package com.polarsparc.jm;

import java.util.Base64;

public class MyB64Enc2 {
    public static void main(String[] args) {
        byte[] secret = "MySup3rS3cr3t#".getBytes();
        
        Base64.Encoder encoder = Base64.getEncoder();
        
        System.out.printf("Encoded secret: %s\n", encoder.encodeToString(secret));
    }
}</pre>
      </div>
    </div>
    <div id="para-div">
      <p>Let us look at another example. The following simple <span class="bold">Java</span> program creates an SSL context the
        old way:</p>
    </div>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.3</div>
      <div class="src-body-1">
      <pre>package com.polarsparc.jm;

import com.sun.net.ssl.SSLContext;
import com.sun.net.ssl.TrustManager;
import com.sun.net.ssl.X509TrustManager;
import java.security.cert.X509Certificate;

public class MyOldSslStuff {
    static TrustManager[] trustAllCerts = new TrustManager[] {
        new X509TrustManager() {
            public X509Certificate[] getAcceptedIssuers() {
                return null;
            }
        
            public boolean isClientTrusted(X509Certificate[] chain) {
                return true;
            }
            
            public boolean isServerTrusted(X509Certificate[] chain) {
                return true;
            }
        }
    };
    
    public static void main(String[] args) {
        try {
            SSLContext context = SSLContext.getInstance("SSL");
            context.init(null, trustAllCerts, null);
            
            System.out.println("Success !!!");
        }
        catch (Exception ex) {
            System.err.println(ex);
        }
    }
}</pre>
      </div>
    </div>
    <div id="para-div">
      <p>To compile the above <span class="bold">Java</span> program using the <span class="bold">Java 8</span> compiler,
        execute the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ javac com/polarsparc/jm/MyOldSslStuff.java</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.7</h4>
      <pre>Note: com/polarsparc/jm/MyOldSslStuff.java uses or overrides a deprecated API.
Note: Recompile with -Xlint:deprecation for details.</pre>
    </div>
    <div id="para-div">
      <p>Now let us try to compile the same <span class="bold">Java</span> program using the <span class="bold">Java 11</span>
        compiler by executing the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ javac com/polarsparc/jm/MyOldSslStuff.java</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.8</h4>
      <pre>com/polarsparc/jm/MyOldSslStuff.java:3: error: package com.sun.net.ssl is not visible
import com.sun.net.ssl.SSLContext;
                  ^
  (package com.sun.net.ssl is declared in module java.base, which does not export it)
com/polarsparc/jm/MyOldSslStuff.java:4: error: package com.sun.net.ssl is not visible
import com.sun.net.ssl.TrustManager;
                  ^
  (package com.sun.net.ssl is declared in module java.base, which does not export it)
com/polarsparc/jm/MyOldSslStuff.java:5: error: package com.sun.net.ssl is not visible
import com.sun.net.ssl.X509TrustManager;
                  ^
  (package com.sun.net.ssl is declared in module java.base, which does not export it)
3 errors</pre>
    </div>
    <div id="para-div">
      <p>From the Output.8 above, we see learn that the package <span class="hi-yellow">com.sun.net.ssl</span> is declared
        in the module <span class="bold">java.base</span> and is *<span class="underbold">NOT</span>* exported.</p>
      <p>To resolve this issue, we need to use the command-line option <span class="hi-blue">--add-exports</span> in the
        <span class="bold">Java 11</span> compiler to force the export of the desired package by breaking the encapsulation
        of internal API and make it accessible.</p>
    </div>
    <div id="para-div">
      <p>Now, let us re-try the compile by executing the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ javac --add-exports java.base/com.sun.net.ssl=ALL-UNNAMED com/polarsparc/jm/MyOldSslStuff.java</p>
    </div>
    <div id="para-div">
      <p>The following will be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.9</h4>
      <pre>Note: com/polarsparc/jm/MyOldSslStuff.java uses or overrides a deprecated API.
Note: Recompile with -Xlint:deprecation for details.
</pre>
    </div>
    <div id="para-div">
      <p>The option <span class="bol;d">--add-exports</span> has the following format:</p>
      <p>&nbsp;&nbsp;&nbsp;&nbsp;<span class="bold">&lt;source-module&gt;</span>/<span class="bold">&lt;package-name&gt;</span>=<span class="bold">&lt;target-module&gt;</span></p>
      <p>The keyword <span class="hi-blue">ALL-UNNAMED</span> for the <span class="bold">&lt;target-module&gt;</span> means,
        all the class(es) from the classpath can access the package <span class="bold">&lt;package-name&gt;</span> from
        <span class="bold">&lt;source-module&gt;</span>.</p>
    </div>
    <br>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="http://openjdk.java.net/projects/jigsaw/" target="_blank"><span class="bold">Modular JDK - Project Jigsaw</span></a></p>
      <p><a href="http://openjdk.java.net/projects/jigsaw/spec/sotms/" target="_blank"><span class="bold">The State of the Module System</span></a></p>
    </div>
    <br/>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>