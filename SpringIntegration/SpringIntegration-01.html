<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="Spring Integration Notes :: Part - 1">
    <meta name="subject" content="Spring Integration Notes :: Part - 1">
    <meta name="keywords" content="eip, java, spring">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>Spring Integration Notes :: Part - 1</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br />
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>Spring Integration Notes :: Part - 1</p>
    </div>
    <br />
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">04/17/2021 (<span class="hi-yellow">UPDATED</span>)</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" />
    <br />
    <div id="section-div">
      <p>Overview</p>
    </div>
    <div id="para-div">
      <p>Any Enterprise (small or large) typically has different application systems (some vendor and some custom built) and often
        times there is a need to integrate two or more of these systems. As we all know, application systems integration in an
        enterprise is always complex and challenging.</p>
      <p>The book <span class="bold"><a href="http://www.amazon.com/gp/product/B000OZ0N9E" target="_blank">Enterprise Integration
        Patterns</a> (EIP)</span> captures and catalogs various enterprise integration patterns.</p>
      <p><span class="hi-yellow">Spring Integration</span> implements the various components and patterns described in the book and
        attempts to simplify enterprise integration.</p>
    </div>
    <div id="section-div">
      <p>Setup</p>
    </div>
    <div id="para-div">
      <p>The setup will be on a <span class="bold">Ubuntu 20.04 LTS</span> based Linux desktop. Ensure at least <span class="bold">
        Java 11</span> or above is installed and setup. Also, ensure <a href="http://maven.apache.org/" target="_blank">
        <span class="hi-yellow">Apache Maven</span></a> is installed and setup.</p>
      <p>We will be using <span class="bold">Spring Integration</span> along with <span class="bold">Spring Framework</span> for all
        the demonstrations. The following are the versions at the time of this article:</p>
      <ul id="blue-disc-ul">
        <li><p><span class="bold">Spring Framework</span> &#8680; <span class="hi-green">5.3.5</span></p></li>
        <li><p><span class="bold">Spring Integration</span> &#8680; <span class="hi-green">5.4.5</span></p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>To setup the Java directory structure for the demonstrations in this part, execute the following commands:</p>
    </div>
    <div id="cmd-div">
      <p>$ cd $HOME</p>
      <p>$ mkdir -p $HOME/java/SpringIntegration</p>
      <p>$ cd $HOME/java/SpringIntegration</p>
      <p>$ mkdir -p src/main/java src/main/resources target</p>
      <p>$ mkdir -p src/main/java/com/polarsparc/si</p>
      <p>$ mkdir -p src/main/java/com/polarsparc/si/p1</p>
      <p>$ mkdir -p src/main/resources/p1</p>
    </div>
    <div id="para-div">
      <p>The following is the listing for the <span class="bold">Maven</span> project file <span class="hi-green">pom.xml</span> that
        will be used:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">pom.xml</div>
      <div class="src-body-1">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.polarsparc.si&lt;/groupId&gt;
    &lt;artifactId&gt;SpringIntegration&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;name&gt;SpringIntegration&lt;/name&gt;
    &lt;description&gt;Spring Integration Examples&lt;/description&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;build&gt;
        &lt;pluginManagement&gt;
            &lt;plugins&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.8.1&lt;/version&gt;
                    &lt;configuration&gt;
                        &lt;fork&gt;true&lt;/fork&gt;
                        &lt;meminitial&gt;128m&lt;/meminitial&gt;
                        &lt;maxmem&gt;512m&lt;/maxmem&gt;
                        &lt;source&gt;11&lt;/source&gt;
                        &lt;target&gt;11&lt;/target&gt;
                    &lt;/configuration&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/pluginManagement&gt;
    &lt;/build&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.annotation&lt;/groupId&gt;
            &lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt;
            &lt;version&gt;1.3.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
            &lt;version&gt;5.3.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
            &lt;version&gt;5.3.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
            &lt;version&gt;5.3.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;
            &lt;artifactId&gt;spring-integration-core&lt;/artifactId&gt;
            &lt;version&gt;5.4.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
            &lt;version&gt;1.7.30&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;
            &lt;version&gt;1.7.30&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
            &lt;version&gt;1.7.30&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>The following is the listing for the <span class="hi-yellow">slf4j-simple</span> logger properties file
        <span class="hi-green">simplelogger.properties</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">simplelogger.properties</div>
      <div class="src-body-1">
<pre>#
### SLF4J Simple Logger properties
#

org.slf4j.simpleLogger.defaultLogLevel=info
org.slf4j.simpleLogger.showDateTime=true
org.slf4j.simpleLogger.dateTimeFormat=yyyy-MM-dd HH:mm:ss:SSS
org.slf4j.simpleLogger.showThreadName=true</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>In <span class="bold">Spring Integration</span>, one can provide the integration flow configuration information using one
        of the following <span class="underbold">3</span> approaches:</p>
      <ul id="blue-disc-ul">
        <li><p><span class="bold">XML based</span> &#8680; via XML configuration files</p></li>
        <li><p><span class="bold">Java Config based</span> &#8680; using POJO classes and some annotations</p></li>
        <li><p><span class="bold">Java DSL based</span> &#8680; using convenient builders and a fluent API and some annotations</p></li>
      </ul>
      <p>We will demonstrate examples using the <span class="underbold">2</span> approaches - <span class="bold">XML based</span>
        and <span class="bold">Java Config based</span>.</p>
    </div>
    <div id="section-div">
      <p>Concepts</p>
    </div>
    <div id="para-div">
      <p><span class="bold">Spring Integration</span> uses the <span class="bold">pipes-and-filter</span> based messaging paradigm
        (similar to two or more commands separated by pipes in <span class="bold">Unix/Linux</span>) for integration, resulting in a
        loosely-coupled, modular and extensible design.</p>
      <p>In <span class="bold">Spring Integration</span> parlance, the <span class="bold">pipes</span> are referred to as the
        <span class="hi-yellow">Channels</span> and the <span class="bold">filters</span> are referred to as the
        <span class="hi-yellow">Endpoints</span>. The data that passes through the <span class="bold">channels</span> and the
        <span class="bold">endpoints</span> is referred to as the <span class="hi-yellow">Messages</span>.</p>
      <p>In other words, the following are the three core components in <span class="bold">Spring Integration</span>:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="bold">Message</span> &#8680; encapsulates the data that is exchanged during the integration of two
            components. Under the hood, it consists of two parts - the <span class="hi-blue">payload</span>, which wraps the actual
            data, and the <span class="hi-blue">header</span> properties, which wraps additional metadata, such as the message-id,
            time-stamp, priority, correlation-id, etc</p>
          <div id="img-outer-div">
            <img class="img-cls" src="./images/spring-int-01.png" alt="Message" />
            <div class="img-cap">Message</div>
          </div>
        </li>
        <li>
          <p><span class="bold">Channel</span> &#8680; is a logical destination where a <span class="bold">message</span> is delivered.
            They can either be consumed from (input) or published to (output).</p>
          <p>A consumer can operate on a <span class="bold">channel</span> in either a <span class="bold">point-to-point</span> mode
            or a <span class="bold">publish-subscribe</span> mode.</p>
          <p>A <span class="bold">channel</span> can also buffer incoming <span class="bold">messages</span> in memory. This allows
            for throttling of the input <span class="bold">messages</span> and preventing the consumer from being overwhelmed</p>
          <div id="img-outer-div">
            <img class="img-cls" src="./images/spring-int-02.png" alt="Channel" />
            <div class="img-cap">Channel</div>
          </div>
        </li>
        <li>
          <p><span class="bold">Endpoint</span> &#8680; is the component that processes <span class="bold">messages</span> by consuming
            from an input <span class="bold">channel</span> and producing response <span class="bold">messages</span> to an output
            <span class="bold">channel</span>. They are the connection point(s) of an application for integration</p>
        </li>
      </ul>
    </div>
    <div id="section-div">
      <p>Hands-on Spring Integration</p>
    </div>
    <div id="para-div">
      <p>Now, let us dive into a simple hello-world like example using <span class="bold">Spring Integration</span>. In this example:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p>The main application will publish a <span class="bold">message</span> containing a text payload to an input
            <span class="bold">channel</span></p>
        </li>
        <li>
          <p>The <span class="bold">message</span> is consumed from the input <span class="bold">channel</span> by a POJO and the
            text is converted to upper-case</p>
        </li>
        <li>
          <p>The resulting upper-case text wrapped in a <span class="bold">message</span> and published to an output <span class="bold">
            channel</span></p>
        </li>
        <li>
          <p>The main application consumes the <span class="bold">message</span> from the output <span class="bold">channel</span>
            and displays the result</p>
        </li>
      </ul>
    </div>
    <table id="step-table">
      <tbody>
        <tr>
          <td class="text-td">XML based Approach</td>
          <td class="pointer-td"></td>
        </tr>
      </tbody>
    </table>
    <div id="para-div">
      <p>The following is the POJO that converts the input text to upper-case. This will act as an <span class="bold">endpoint</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.1</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseHandler
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class StrUpCaseHandler {
    private static final Logger LOGGER = LoggerFactory.getLogger(StrUpCaseHandler.class);

    public String handler(String msg) {
        LOGGER.info("INPUT: msg = {}", msg);

        return msg.toUpperCase();
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Next, the following is the <span class="bold">XML</span> based <span class="bold">Spring Integration</span> configuration
        that wires up the <span class="bold">channels</span> and the <span class="bold">endpoint</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.2</div>
      <div class="src-body-1">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:int="http://www.springframework.org/schema/integration"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
                            http://www.springframework.org/schema/beans/spring-beans.xsd
                            http://www.springframework.org/schema/integration
                            http://www.springframework.org/schema/integration/spring-integration.xsd"&gt;

    &lt;bean id="inMsgHandler" class="com.polarsparc.si.p1.StrUpCaseHandler" /&gt;

    &lt;int:channel id="inChannel" /&gt;

    &lt;int:channel id="outChannel"&gt;
        &lt;int:queue capacity="5" /&gt;
    &lt;/int:channel&gt;

    &lt;int:service-activator input-channel="inChannel"
                            output-channel="outChannel"
                            ref="inMsgHandler"
                            method="handler" /&gt;

&lt;/beans&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">Listing.2</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li>
          <p>Notice the <span class="bold">XML</span> namespace definition for <span class="bold">Spring Integration</span> with the
            prefix <span class="bold">int</span> - <span class="hi-yellow">xmlns:int="http://www.springframework.org/schema/integration"</span></p>
        </li>
        <li>
          <p>We define a bean with an <span class="bold">id</span> of <span class="bold">inMsgHandler</span> to be an instance of our
            POJO <span class="hi-yellow">com.polarsparc.si.p1.StrUpCaseHandler</span> from <span class="bold">Listing.1</span></p>
        </li>
        <li>
          <p>We define an input <span class="bold">channel</span> with an <span class="bold">id</span> of <span class="bold">inChannel</span>.</p>
          <p>Under the hood, <span class="bold">Spring Integration</span> will use an instance of
            <span class="hi-yellow">org.springframework.integration.channel.DirectChannel</span> which implements the interface
            <span class="hi-yellow">org.springframework.messaging.SubscribableChannel</span>. This type of a <span class="bold">channel
            </span> is one of the simplest implementations with a <span class="bold">point-to-point</span> semantics and the
            <span class="bold">message</span> is directly delivered to the subscribed consumer</p>
        </li>
        <li>
          <p>We define an output <span class="bold">channel</span> with an <span class="bold">id</span> of <span class="bold">outChannel</span>.
            This is a queue backed channel with a maximum capacity of 5 <span class="bold">messages</span>. The queue is used for buffering
            <span class="bold">messages</span> and to throttle the consumer.</p>
          <p>Under the hood, <span class="bold">Spring Integration</span> will use an instance of
            <span class="hi-yellow">org.springframework.integration.channel.QueueChannel</span> which implements the interface
            <span class="hi-yellow">org.springframework.messaging.PollableChannel</span>. This type of a <span class="bold">channel</span>
            is <span class="bold">point-to-point</span> with only one consumer processing a <span class="bold">message</span> at a time</p>
        </li>
        <li>
          <p>Finally, we define the <span class="hi-yellow">service-activator</span>, which is a type of <span class="bold">endpoint</span>
            that invokes a specified method on a specified bean. In this case, the <span class="bold">endpoint</span> will invoke the
            method <span class="hi-green">handler</span> on the bean with the <span class="bold">id</span> of <span class="bold">inChannel</span></p>
          <p>In other words, a <span class="bold">Service Activator</span> invokes an operation on some service object to process the
            incoming <span class="bold">message</span>, extracting the <span class="bold">message</span> payload and converting it
            to the type of the operations input parameter type. Once the service operation completes and returns a value, that return
            value is wrapped in a <span class="bold">message</span> and sent to an output <span class="bold">channel</span></p>
          <div id="img-outer-div">
            <img class="img-cls" src="./images/spring-int-03.png" alt="Service Activator" />
            <div class="img-cap">Service Activator</div>
          </div>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>And finally, the following is the main application that publishes and consumes data:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.3</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseMainXml
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.messaging.Message;
import org.springframework.messaging.MessageChannel;
import org.springframework.messaging.PollableChannel;
import org.springframework.integration.support.MessageBuilder;

public class StrUpCaseMainXml {
    private static final Logger LOGGER = LoggerFactory.getLogger(StrUpCaseMainXml.class);

    public static void main(String[] args) {
        ApplicationContext context = new ClassPathXmlApplicationContext("p1/StrUpCase.xml");

        Message&lt;?&gt; in = MessageBuilder.withPayload("Hello Spring Integration with Xml").build();

        MessageChannel inMsg = (MessageChannel) context.getBean("inChannel");

        PollableChannel outMsg = (PollableChannel) context.getBean("outChannel");

        inMsg.send(in);

        Message&lt;?&gt; out = outMsg.receive();

        LOGGER.info("OUTPUT: {}", out);
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">Listing.3</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li>
          <p>We first create a Spring <span class="bold">ApplicationContext</span> using the <span class="bold">XML</span> configuration
            from <span class="bold">Listing.2</span></p>
        </li>
        <li>
          <p>A <span class="bold">message</span> in <span class="bold">Spring Integration</span> is defined by the interface
            <span class="hi-yellow">org.springframework.messaging.Message</span>.</p>
          <p>We create an instance of <span class="bold">message</span> using the builder class
            <span class="hi-yellow">org.springframework.integration.support.MessageBuilder</span></p>
        </li>
        <li>
          <p>A <span class="bold">channel</span> in <span class="bold">Spring Integration</span> is defined by the interface
            <span class="hi-yellow">org.springframework.messaging.MessageChannel</span>.</p>
          <p>We fetch the input <span class="bold">channel</span> with the <span class="bold">id</span> of <span class="bold">inChannel
            </span> from the Spring context</p>
        </li>
        <li>
          <p>We fetch the queue backed output <span class="bold">channel</span> with the <span class="bold">id</span> of
            <span class="bold">outChannel</span> from the Spring context</p>
        </li>
        <li>
          <p>We publish the created <span class="bold">message</span> to the input <span class="bold">channel</span></p>
        </li>
        <li>
          <p>Finally, we poll for a response <span class="bold">message</span> from the output <span class="bold">channel</span>
            and display the response</p>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>To execute the code from <span class="bold">Listing.3</span>, open a terminal window and run the following commands:</p>
    </div>
    <div id="cmd-div">
      <p>$ cd $HOME/java/SpringIntegration</p>
      <p>$ mvn exec:java -Dexec.mainClass="com.polarsparc.si.p1.StrUpCaseMainXml"</p>
    </div>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.1</h4>
      <pre>[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------&lt; com.polarsparc.si:SpringIntegration &gt;-----------------
[INFO] Building SpringIntegration 1.0
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- exec-maven-plugin:3.0.0:java (default-cli) @ SpringIntegration ---
2021-04-17 20:46:56:309 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2021-04-17 20:46:56:313 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'taskScheduler' has been explicitly defined. Therefore, a default ThreadPoolTaskScheduler will be created.
2021-04-17 20:46:56:316 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2021-04-17 20:46:56:534 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler - Initializing ExecutorService 'taskScheduler'
2021-04-17 20:46:56:567 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {service-activator} as a subscriber to the 'inChannel' channel
2021-04-17 20:46:56:568 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.channel.DirectChannel - Channel 'org.springframework.context.support.ClassPathXmlApplicationContext@42062658.inChannel' has 1 subscriber(s).
2021-04-17 20:46:56:569 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean 'org.springframework.integration.config.ConsumerEndpointFactoryBean#0'
2021-04-17 20:46:56:569 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2021-04-17 20:46:56:570 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.channel.PublishSubscribeChannel - Channel 'org.springframework.context.support.ClassPathXmlApplicationContext@42062658.errorChannel' has 1 subscriber(s).
2021-04-17 20:46:56:571 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2021-04-17 20:46:56:581 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO org.springframework.integration.handler.support.MessagingMethodInvokerHelper - Overriding default instance of MessageHandlerMethodFactory with provided one.
2021-04-17 20:46:56:586 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO com.polarsparc.si.p1.StrUpCaseHandler - INPUT: msg = Hello Spring Integration with Xml
2021-04-17 20:46:56:588 [com.polarsparc.si.p1.StrUpCaseMainXml.main()] INFO com.polarsparc.si.p1.StrUpCaseMainXml - OUTPUT: GenericMessage [payload=HELLO SPRING INTEGRATION WITH XML, headers={id=d8ec9e77-b73a-b38f-f4c3-bade5efbb55a, timestamp=1619138816588}]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.246 s
[INFO] Finished at: 2021-04-17T20:46:56-04:00
[INFO] ------------------------------------------------------------------------</pre>
    </div>
    <table id="step-table">
      <tbody>
        <tr>
          <td class="text-td">Java Config based Approach</td>
          <td class="pointer-td"></td>
        </tr>
      </tbody>
    </table>
    <div id="para-div">
      <p>The following is the Java Config based POJO that defines the input and output <span class="bold">channel</span>s similar
        to the one defined in the <span class="bold">XML</span> configuration file of <span class="bold">Listing.2</span> above:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.4</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseConfig
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.integration.channel.DirectChannel;
import org.springframework.integration.channel.QueueChannel;
import org.springframework.integration.config.EnableIntegration;
import org.springframework.messaging.MessageChannel;

@Configuration
@EnableIntegration
public class StrUpCaseConfig {
    @Bean
    public MessageChannel inChannel() {
        return new DirectChannel();
    }

    @Bean
    public MessageChannel outChannel() {
        return new QueueChannel(5);
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of 3 annotations <span class="hi-yellow">@Configuration</span>, <span class="hi-yellow">@EnableIntegration</span>,
        and <span class="hi-yellow">@Bean</span> in the <span class="bold">Listing.4</span> above.</p>
      <p><span class="bold">@Configuration</span> is a class level annotation and is used to tag a class as the source of bean
        definitions. It is similar to the XML element <span class="bold">&lt;beans&gt;</span> from the XML based configuration file.</p>
      <p><span class="bold">@EnableIntegration</span> is a class level annotation that is used to register the core components of
        the <span class="bold">Spring Integration</span> framework.</p>
      <p><span class="bold">@Bean</span> is a method level annotation and corresponds to the XML element <span class="bold">
      &lt;bean&gt;</span> from the XML based configuration file. By default, the method name is used as the <span class="bold">
      name</span> of the bean.</p>
    </div>
    <br/>
    <div id="error-div">
      <h4>!!! ATTENTION !!!</h4>
      <pre>One will encounter the following exception (at runtime) if the annotation <span class="bold">@EnableIntegration</span> is not used:
        <br/>
    Exception in thread "main" org.springframework.messaging.MessageDeliveryException: Dispatcher has no subscribers for channel</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>The following is the Java Config based POJO that acts as an <span class="bold">endpoint</span> that converts the input text
        to upper-case:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.5</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseHandler2
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.annotation.Configuration;
import org.springframework.integration.annotation.ServiceActivator;
import org.springframework.integration.config.EnableIntegration;

@Configuration
@EnableIntegration
public class StrUpCaseHandler2 {
    private static final Logger LOGGER = LoggerFactory.getLogger(StrUpCaseHandler2.class);

    @ServiceActivator(inputChannel = "inChannel", outputChannel = "outChannel")
    public String handler(String msg) {
        LOGGER.info("INPUT: msg = {}", msg);

        return msg.toUpperCase();
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of a new annotation <span class="hi-yellow">@ServiceActivator</span> in the <span class="bold">Listing.5
        </span> above.</p>
      <p><span class="bold">@ServiceActivator</span> is a method level annotation and corresponds to the XML element <span class="bold">
      &lt;bean&gt;</span> with the <span class="bold">id</span> of <span class="bold">inMsgHandler</span> from the XML based
      configuration file in <span class="bold">Listing.2</span> above. In addition, it specifies the names of the associated input
      and output <span class="bold">channel</span>s for this <span class="bold">endpoint</span>.</p>
    </div>
    <div id="para-div">
      <p>And finally, the following is the main application that uses the POJOs from <span class="bold">Listing.4</span> and
        <span class="bold">Listing.5</span> to publish and consume data:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.6</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseMainConfig
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.integration.support.MessageBuilder;
import org.springframework.messaging.Message;
import org.springframework.messaging.MessageChannel;
import org.springframework.messaging.PollableChannel;

public class StrUpCaseMainConfig {
    private static final Logger LOGGER = LoggerFactory.getLogger(StrUpCaseMainConfig.class);

    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(StrUpCaseConfig.class,
                StrUpCaseHandler2.class);

        Message&lt;?&gt; in = MessageBuilder.withPayload("Hello Spring Integration with Config").build();

        MessageChannel inMsg = (MessageChannel) context.getBean("inChannel");

        PollableChannel outMsg = (PollableChannel) context.getBean("outChannel");

        inMsg.send(in);

        Message&lt;?&gt; out = outMsg.receive();

        LOGGER.info("OUTPUT: {}", out);
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>To execute the code from <span class="bold">Listing.6</span>, open a terminal window and run the following commands:</p>
    </div>
    <div id="cmd-div">
      <p>$ cd $HOME/java/SpringIntegration</p>
      <p>$ mvn exec:java -Dexec.mainClass="com.polarsparc.si.p1.StrUpCaseMainConfig"</p>
    </div>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.2</h4>
      <pre>[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------&lt; com.polarsparc.si:SpringIntegration &gt;-----------------
[INFO] Building SpringIntegration 1.0
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- exec-maven-plugin:3.0.0:java (default-cli) @ SpringIntegration ---
2021-04-17 20:49:11:718 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2021-04-17 20:49:11:724 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'taskScheduler' has been explicitly defined. Therefore, a default ThreadPoolTaskScheduler will be created.
2021-04-17 20:49:11:728 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2021-04-17 20:49:11:770 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'integrationChannelResolver' of type [org.springframework.integration.support.channel.BeanFactoryChannelResolver] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2021-04-17 20:49:11:774 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'integrationDisposableAutoCreatedBeans' of type [org.springframework.integration.config.annotation.Disposables] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2021-04-17 20:49:11:971 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler - Initializing ExecutorService 'taskScheduler'
2021-04-17 20:49:12:046 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2021-04-17 20:49:12:047 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.channel.PublishSubscribeChannel - Channel 'org.springframework.context.annotation.AnnotationConfigApplicationContext@396abb96.errorChannel' has 1 subscriber(s).
2021-04-17 20:49:12:047 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2021-04-17 20:49:12:048 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {service-activator:strUpCaseHandler2.handler.serviceActivator} as a subscriber to the 'inChannel' channel
2021-04-17 20:49:12:049 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.channel.DirectChannel - Channel 'org.springframework.context.annotation.AnnotationConfigApplicationContext@396abb96.inChannel' has 1 subscriber(s).
2021-04-17 20:49:12:049 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean 'strUpCaseHandler2.handler.serviceActivator'
2021-04-17 20:49:12:056 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO org.springframework.integration.handler.support.MessagingMethodInvokerHelper - Overriding default instance of MessageHandlerMethodFactory with provided one.
2021-04-17 20:49:12:060 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO com.polarsparc.si.p1.StrUpCaseHandler2 - INPUT: msg = Hello Spring Integration with Config
2021-04-17 20:49:12:062 [com.polarsparc.si.p1.StrUpCaseMainConfig.main()] INFO com.polarsparc.si.p1.StrUpCaseMainConfig - OUTPUT: GenericMessage [payload=HELLO SPRING INTEGRATION WITH CONFIG, headers={id=55d5c657-3b9a-a929-af78-ffc51a82de1e, timestamp=1619138952062}]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.103 s
[INFO] Finished at: 2021-04-17T20:49:12-04:00
[INFO] ------------------------------------------------------------------------</pre>
    </div>
    <div id="para-div">
      <p><span class="bold">HOORAY !!!</span> We have successfully demonstrated a simple application using <span class="bold">Spring
        Integration</span>.</p>
    </div>
    <div id="para-div">
      <p>One observation from the code in <span class="bold">Listing.3</span> (OR <span class="bold">Listing.6</span>) is that we
        have a tight coupling between the core application logic and <span class="bold">Spring Integration</span>. In other words,
        the application logic directly references and uses some of the <span class="bold">Spring Integration</span> components such
        as <span class="bold">Message</span>, <span class="bold">MessageBuilder</span>, <span class="bold">MessageChannel</span> and
        <span class="bold">PollableChannel</span>.</p>
      <p>It is desirable to have an application built with no direct and tight coupling with the core <span class="bold">Spring
        Integration</span> components.</p>
      <p>Let us go ahead and eliminate the direct references to <span class="bold">Spring Integration</span> components from the
        application logic in <span class="bold">Listing.3</span> (AND <span class="bold">Listing.6</span>).</p>
    </div>
    <table id="step-table">
      <tbody>
        <tr>
          <td class="text-td">XML based Approach</td>
          <td class="pointer-td"></td>
        </tr>
      </tbody>
    </table>
    <div id="para-div">
      <p>The following is a simple interface to send and receive text data:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.7</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseGateway
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

public interface StrUpCaseGateway {
    public String receive();

    public void send(String msg);
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Next, the following is the modified <span class="bold">XML</span> based <span class="bold">Spring Integration</span>
        configuration that wires up the <span class="bold">channels</span> and the <span class="bold">endpoint</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.8</div>
      <div class="src-body-1">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:int="http://www.springframework.org/schema/integration"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
                            http://www.springframework.org/schema/beans/spring-beans.xsd
                            http://www.springframework.org/schema/integration
                            http://www.springframework.org/schema/integration/spring-integration.xsd"&gt;

    &lt;bean id="inMsgHandler" class="com.polarsparc.si.p1.StrUpCaseHandler" /&gt;

    &lt;int:channel id="inChannel" /&gt;

    &lt;int:channel id="outChannel"&gt;
        &lt;int:queue capacity="5" /&gt;
    &lt;/int:channel&gt;

    &lt;!--
        The primary purpose of a Gateway is to hide the messaging API provided
        by Spring Integration
    --&gt;

    &lt;int:gateway id="gateway"
                  service-interface="com.polarsparc.si.p1.StrUpCaseGateway"
                  default-request-channel="inChannel"
                  default-reply-channel="outChannel" /&gt;

    &lt;int:service-activator input-channel="inChannel"
                            output-channel="outChannel"
                            ref="inMsgHandler"
                            method="handler" /&gt;

&lt;/beans&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Most of the <span class="bold">XML</span> configuration is similar to that of <span class="bold">Listing.2</span> except
        for one aspect that needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li>
          <p>A <span class="hi-yellow">gateway</span> is a type of proxy that hides the underlying messaging components of
            <span class="bold">Spring Integration</span> from the core application.</p>
          <p>In order to use the <span class="bold">gateway</span> pattern, we need to define a simple interface that exposes the
            desired functionality (sending and receiving data in this example). This is exactly what we did with our custom interface
            in <span class="bold">Listing.7</span>.</p>
          <p>Under the hood, <span class="bold">Spring Integration</span> makes uses of
            <span class="hi-yellow">org.springframework.integration.gateway.GatewayProxyFactoryBean</span> to dynamically generate
            a proxy for the specified custom interface and hides all the interaction with messaging components. The application will
            only invoke the methods on the custom interface</p>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>The following is our modified main application that uses the methods in our custom interface from <span class="bold">
        Listing.7</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.9</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCase2MainXml
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class StrUpCase2MainXml {
    private static final Logger LOGGER = LoggerFactory.getLogger(StrUpCase2MainXml.class);

    public static void main(String[] args) {
        ApplicationContext context = new ClassPathXmlApplicationContext("p1/StrUpCase2.xml");

        StrUpCaseGateway gateway = (StrUpCaseGateway) context.getBean("gateway");
        gateway.send("Spring Integration using Gateway with Xml");

        String msg = gateway.receive();

        LOGGER.info("OUTPUT: {}", msg);
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>As can be seen from the code in <span class="bold">Listing.9</span>, the core application logic does not use any of the
        <span class="bold">Spring Integration</span> components.</p>
    </div>
    <div id="para-div">
      <p>To execute the code from <span class="bold">Listing.9</span>, open a terminal window and run the following commands:</p>
    </div>
    <div id="cmd-div">
      <p>$ cd $HOME/java/SpringIntegration</p>
      <p>$ mvn exec:java -Dexec.mainClass="com.polarsparc.si.p1.StrUpCase2MainXml"</p>
    </div>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.3</h4>
      <pre>[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------&lt; com.polarsparc.si:SpringIntegration &gt;-----------------
[INFO] Building SpringIntegration 1.0
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- exec-maven-plugin:3.0.0:java (default-cli) @ SpringIntegration ---
2021-04-17 20:51:11:137 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2021-04-17 20:51:11:141 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'taskScheduler' has been explicitly defined. Therefore, a default ThreadPoolTaskScheduler will be created.
2021-04-17 20:51:11:145 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2021-04-17 20:51:11:357 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler - Initializing ExecutorService 'taskScheduler'
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.springframework.util.ReflectionUtils (file:/home/bswamina/.m2/repository/org/springframework/spring-core/5.3.5/spring-core-5.3.5.jar) to constructor java.lang.invoke.MethodHandles$Lookup(java.lang.Class)
WARNING: Please consider reporting this to the maintainers of org.springframework.util.ReflectionUtils
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
2021-04-17 20:51:11:450 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {service-activator} as a subscriber to the 'inChannel' channel
2021-04-17 20:51:11:451 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.channel.DirectChannel - Channel 'org.springframework.context.support.ClassPathXmlApplicationContext@42062658.inChannel' has 1 subscriber(s).
2021-04-17 20:51:11:451 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean 'org.springframework.integration.config.ConsumerEndpointFactoryBean#0'
2021-04-17 20:51:11:452 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2021-04-17 20:51:11:453 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.channel.PublishSubscribeChannel - Channel 'org.springframework.context.support.ClassPathXmlApplicationContext@42062658.errorChannel' has 1 subscriber(s).
2021-04-17 20:51:11:453 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2021-04-17 20:51:11:454 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.gateway.GatewayProxyFactoryBean$MethodInvocationGateway - started bean 'gateway#send(String)'
2021-04-17 20:51:11:455 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.gateway.GatewayProxyFactoryBean$MethodInvocationGateway - started bean 'gateway#receive()'
2021-04-17 20:51:11:456 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.gateway.GatewayProxyFactoryBean - started bean 'gateway'
2021-04-17 20:51:11:466 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO org.springframework.integration.handler.support.MessagingMethodInvokerHelper - Overriding default instance of MessageHandlerMethodFactory with provided one.
2021-04-17 20:51:11:470 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO com.polarsparc.si.p1.StrUpCaseHandler - INPUT: msg = Spring Integration using Gateway with Xml
2021-04-17 20:51:11:472 [com.polarsparc.si.p1.StrUpCase2MainXml.main()] INFO com.polarsparc.si.p1.StrUpCase2MainXml - OUTPUT: SPRING INTEGRATION USING GATEWAY WITH XML
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.238 s
[INFO] Finished at: 2021-04-17T20:51:11-04:00
[INFO] ------------------------------------------------------------------------</pre>
    </div>
    <table id="step-table">
      <tbody>
        <tr>
          <td class="text-td">Java Config based Approach</td>
          <td class="pointer-td"></td>
        </tr>
      </tbody>
    </table>
    <div id="para-div">
      <p>The following is the Java Config based POJO that defines the <span class="bold">gateway</span> similar to the one defined
        in the <span class="bold">XML</span> configuration file of <span class="bold">Listing.8</span> above:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.10</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCaseGateway2
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.springframework.context.annotation.Configuration;
import org.springframework.integration.annotation.IntegrationComponentScan;
import org.springframework.integration.annotation.MessagingGateway;
import org.springframework.integration.config.EnableIntegration;

@Configuration
@EnableIntegration
@IntegrationComponentScan
@MessagingGateway(name = "gateway", defaultRequestChannel = "inChannel", defaultReplyChannel = "outChannel")
public interface StrUpCaseGateway2 {
    public String receive();

    public void send(String msg);
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of <span class="underbold">2</span> new annotations <span class="hi-yellow">@IntegrationComponentScan</span>
        and <span class="hi-yellow">@MessagingGateway</span> in the <span class="bold">Listing.10</span> above.</p>
      <p><span class="bold">@MessagingGateway</span> is a method level annotation and corresponds to the XML element <span class="bold">
        &lt;gateway&gt;</span> with the <span class="bold">id</span> of <span class="bold">gateway</span> from the XML based
        configuration file in <span class="bold">Listing.8</span> above. In addition, it also specifies the names of the associated
        request and reply <span class="bold">channel</span>s.</p>
      <p><span class="bold">@IntegrationComponentScan</span> is a class level annotation and scans Java POJOs for the annotation
        <span class="bold">@MessagingGateway</span> to dynamically generate a proxy for the specified custom <span class="bold">
        gateway</span> interface.</p>
    </div>
    <br/>
    <div id="error-div">
      <h4>!!! ATTENTION !!!</h4>
      <pre>One will encounter the following exception (at runtime) if the annotation <span class="bold">@IntegrationComponentScan</span> is not used:
        <br/>
    Exception in thread "main" org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'gateway' available</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>And finally, the following is the main application that uses the POJOs from <span class="bold">Listing.4</span>,
        <span class="bold">Listing.5</span>, and <span class="bold">Listing.10</span> to publish and consume data:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">Listing.11</div>
      <div class="src-body-1">
<pre>/*
 * Name:   StrUpCase2MainConfig
 * Author: Bhaskar S
 * Date:   04/16/2021
 * Blog:   https://polarsparc.github.io
 */

package com.polarsparc.si.p1;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class StrUpCase2MainConfig {
    private static final Logger LOGGER = LoggerFactory.getLogger(StrUpCase2MainConfig.class);

    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(StrUpCaseConfig.class,
                StrUpCaseHandler2.class, StrUpCaseGateway2.class);

        StrUpCaseGateway2 gateway = (StrUpCaseGateway2) context.getBean("gateway");
        gateway.send("Spring Integration using Gateway with Config");

        String msg = gateway.receive();

        LOGGER.info("OUTPUT: {}", msg);
    }
}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>To execute the code from <span class="bold">Listing.11</span>, open a terminal window and run the following commands:</p>
    </div>
    <div id="cmd-div">
      <p>$ cd $HOME/java/SpringIntegration</p>
      <p>$ mvn exec:java -Dexec.mainClass="com.polarsparc.si.p1.StrUpCase2MainConfig"</p>
    </div>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.4</h4>
      <pre>[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------&lt; com.polarsparc.si:SpringIntegration &gt;-----------------
[INFO] Building SpringIntegration 1.0
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- exec-maven-plugin:3.0.0:java (default-cli) @ SpringIntegration ---
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.springframework.cglib.core.ReflectUtils (file:/home/bswamina/.m2/repository/org/springframework/spring-core/5.3.5/spring-core-5.3.5.jar) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int,java.security.ProtectionDomain)
WARNING: Please consider reporting this to the maintainers of org.springframework.cglib.core.ReflectUtils
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
2021-04-17 20:55:31:638 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2021-04-17 20:55:31:644 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'taskScheduler' has been explicitly defined. Therefore, a default ThreadPoolTaskScheduler will be created.
2021-04-17 20:55:31:648 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.config.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2021-04-17 20:55:31:685 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'integrationChannelResolver' of type [org.springframework.integration.support.channel.BeanFactoryChannelResolver] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2021-04-17 20:55:31:721 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'integrationDisposableAutoCreatedBeans' of type [org.springframework.integration.config.annotation.Disposables] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2021-04-17 20:55:31:875 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler - Initializing ExecutorService 'taskScheduler'
2021-04-17 20:55:31:992 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2021-04-17 20:55:31:993 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.channel.PublishSubscribeChannel - Channel 'org.springframework.context.annotation.AnnotationConfigApplicationContext@396abb96.errorChannel' has 1 subscriber(s).
2021-04-17 20:55:31:994 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2021-04-17 20:55:31:995 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - Adding {service-activator:strUpCaseHandler2.handler.serviceActivator} as a subscriber to the 'inChannel' channel
2021-04-17 20:55:31:996 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.channel.DirectChannel - Channel 'org.springframework.context.annotation.AnnotationConfigApplicationContext@396abb96.inChannel' has 1 subscriber(s).
2021-04-17 20:55:31:997 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.endpoint.EventDrivenConsumer - started bean 'strUpCaseHandler2.handler.serviceActivator'
2021-04-17 20:55:31:998 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.gateway.GatewayProxyFactoryBean$MethodInvocationGateway - started bean 'gateway#send(String)'
2021-04-17 20:55:31:999 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.gateway.GatewayProxyFactoryBean$MethodInvocationGateway - started bean 'gateway#receive()'
2021-04-17 20:55:32:000 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.gateway.GatewayProxyFactoryBean - started bean 'gateway'
2021-04-17 20:55:32:014 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO org.springframework.integration.handler.support.MessagingMethodInvokerHelper - Overriding default instance of MessageHandlerMethodFactory with provided one.
2021-04-17 20:55:32:017 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO com.polarsparc.si.p1.StrUpCaseHandler2 - INPUT: msg = Spring Integration using Gateway with Config
2021-04-17 20:55:32:019 [com.polarsparc.si.p1.StrUpCase2MainConfig.main()] INFO com.polarsparc.si.p1.StrUpCase2MainConfig - OUTPUT: SPRING INTEGRATION USING GATEWAY WITH CONFIG
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.290 s
[INFO] Finished at: 2021-04-17T20:55:32-04:00
[INFO] ------------------------------------------------------------------------</pre>
    </div>
    <div id="para-div">
      <p><span class="bold">BINGO !!!</span> We have successfully demonstrated a simple application using <span class="bold">Spring
        Integration</span> without the tight coupling.</p>
    </div>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://docs.spring.io/spring-integration/docs/current/reference/html/overview.html" target="_blank"><span class="bold">Integration - Overview</span></a></p>
      <p><a href="https://docs.spring.io/spring-integration/docs/current/reference/html/message.html" target="_blank"><span class="bold">Integration - Message</span></a></p>
      <p><a href="https://docs.spring.io/spring-integration/docs/current/reference/html/core.html" target="_blank"><span class="bold">Integration - Core Messaging</span></a></p>
      <p><a href="https://docs.spring.io/spring-integration/docs/current/reference/html/messaging-endpoints.html" target="_blank"><span class="bold">Integration - Messaging Endpoints</span></a></p>
    </div>
    <br/>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
