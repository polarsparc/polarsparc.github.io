<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1252">
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="Shamir's Secret Sharing Unraveled">
    <meta name="subject" content="Shamir's Secret Sharing Unraveled">
    <meta name="keywords" content="blockchain, cryptography">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>Shamir's Secret Sharing Unraveled</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br/>
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>Shamir's Secret Sharing Unraveled</p>
    </div>
    <br />
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">09/15/2018</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" /> <br />
    <div id="step-div">
      <p>Overview</p>
    </div>
    <div id="para-div">
      <p>Have you ever heard the phrases <span class="hi-yellow">Key Sharding</span> or <span class="hi-yellow">
        Secret Sharing</span> in the context of any of the popular crytocurrencies <span class="bold">Bitcoin</span>
        or <span class="bold">Ether</span> ???</p>
      <p>Interested in understanding what it means and how it works ??? If, yes, read on ...</p>
      <p>Alice is wealthy individual, owning lots of <span class="bold">Bitcoin</span>s in her digital wallet, which
        holds her account consisting of a private key and a public key. Alice uses her private key <span class="bold">
        only</span> when spending her <span class="bold">Bitcoin</span>s. She wants to backup her private key so that
        in an event of any disaster, she is able to restore her private key from the backup. Without the private key
        Alice will not be able to spend the <span class="bold">Bitcoin</span>s she owns.</p>
      <p>Imagine Alice is able to securely split her private key into unique parts using an algorithm and backup those
        parts in different secure locations. In order to restore the original private key, the various unique parts
        need to come together in a specific order using an algorithm. How cool that would be ???</p>
      <p>This is exactly what <span class="bold">Key Sharding</span> or <span class="bold">Secret Sharing</span> is,
        and the algorithm behind that is called <span class="hi-yellow">Shamir's Secret Sharing</span>.</p>
      <p>The basic idea behind <span class="bold">Shamir's Secret Sharing</span> is to split a secret into <span
        class="bold">n</span> unique parts such that, knowing any combination of <span class="bold">k</span> parts
        (also known as the <span class="hi-yellow">Threshold</span>), where <span class="bold">k &lt;= n</span>, is
        enough to recreate the original secret. This approach is often referred to as <span class="bold">k</span>
        -of-<span class="bold">n</span> threshold scheme in the cryptographic circles.</p>
    </div>
    <div id="para-div">
      <p>Under-the-hood <span class="bold">Shamir's Secret Sharing</span> leverages a <span class="bold">polynomial</span>
        equation <span class="bold">f(x)</span> of degree <span class="bold">k-1</span>, such that the secret that is split
        into <span class="bold">k</span> parts, all lie along the path of the <span class="bold">polynomial</span>, with
        <span class="hi-yellow">f(0)</span> representing the secret.</p>
      <p>Sounds complicated ??? We will see that it is not as we develop an intuition by looking at simple use-cases.</p>
    </div>
    <div id="para-div">
      <p>In order to keep things simple, let us assume Alice's private key is a 4-digit pin <span class="hi-blue">1420</span>.</p>
    </div>
    <div id="step-div">
      <p>2-of-2 Scheme</p>
    </div>
    <div id="para-div">
      <p>Alice desires to backup her secret pin by splitting the pin into two parts (<span class="bold">k</span> = 
        <span class="hi-blue">2</span>) and sharing each part with one of her two friends Bob and Charlie. Note that Alice
        could have shared a third part with another friend Dave. This would be the <span class="bold">2-of-3</span> schema,
        with <span class="bold">k = 2</span> as the threshold. In other words, Alice would need any two of the three parts
        to reconstruct her secret pin.</p>
      <p>Using <span class="bold">Shamir's Secret Sharing</span> schema, this implies a <span class="bold">polynomial</span>
        equation of degree <span class="bold">(k - 1)</span> = <span class="hi-blue">1</span>.</p>
    </div>
    <div id="para-div">
      <p>A <span class="bold">polynomial</span> of degree <span class="bold">1</span> is a <span class="bold">line</span>
        with an equation of the form:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-01.png" class="img-cls" alt="Line" />
      <div class="img-cap">Equation.1</div>
    </div>
    <div id="para-div">
      <p>where <span class="bold">a<sub>0</sub></span> and <span class="bold">a<sub>1</sub></span> are the coefficients
        of the first-degree <span class="bold">polynomial</span> (equation of a line).</p>
    </div>
    <div id="para-div">
      <p>Since <span class="bold">f(0)</span> is the secret <span class="bold">1420</span>, we can deduce the value for
        the coefficient <span class="bold">a<sub>0</sub></span> = <span class="bold">1420</span> and write the equation
        as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-02.png" class="img-cls" alt="Line" />
      <div class="img-cap">Equation.2</div>
    </div>
    <div id="para-div">
      <p>Next, Alice will pick a random value for the coefficient <span class="bold">a<sub>1</sub></span> = <span
        class="hi-blue">80</span> to arrive at the final equation as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-03.png" class="img-cls" alt="Line" />
      <div class="img-cap">Equation.3</div>
    </div>
    <div id="para-div">
      <p>Substituting <span class="bold">x</span> = <span class="bold">1</span>, we get <span class="bold">f(1)</span>
        = <span class="hi-blue">1500</span>, for <span class="bold">x</span> = <span class="bold">2</span>, we get
        <span class="bold">f(2)</span> = <span class="hi-blue">1580</span>, for <span class="bold">x</span> =
        <span class="bold">3</span>, we get <span class="bold">f(3)</span> = <span class="hi-blue">1660</span> and so on.
        The points (1, 1500), (2, 1580), (3, 1660), etc., all lie along the path of the Equation.3 from above.</p>
    </div>
    <div id="para-div">
      <p>Alice can now share the value <span class="hi-yellow">1660</span> with Bob and the value <span class="hi-yellow">1580</span>
        with Charlie for safe-keeping. Alice will retain the information of the <span class="bold">x</span> values corresponding
        to the parts shared with Bob and Charlie.</p>
    </div>
    <div id="para-div">
      <p>To restore the original secret pin, Alice will get the value <span class="bold">1660</span> from Bob and the value
        <span class="bold">1580</span> from Charlie and plug the values into the Equation.1 along with the corresponding
        <span class="bold">x</span> values [(x=3, f(3)=1660), (x=2, f(2)=1580)] to arrive at the following system of equations:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-04.png" class="img-cls" alt="Equations" />
      <div class="img-cap">Equation.4</div>
    </div>
    <div id="para-div">
      <p>Solving the equations <span class="bold">(1)</span> and <span class="bold">(2)</span> from above, we can deduce the
        value for the coefficient <span class="bold">a<sub>0</sub></span> = <span class="bold">1420</span> and the value for
        coefficient <span class="bold">a<sub>1</sub></span> = <span class="bold">80</span>.</p>
    </div>
    <div id="para-div">
      <p>Plugging the value of these coefficients into the Equation.1, Alice will be able to arrive at the equation that is
        the same as Equation.3 from above. The value for <span class="bold">f(0)</span> represents the original secret pin.</p>
    </div>
    <div id="para-div">
      <p>Makes sense ??? No ??? If not, let us look at one more example to drive the point home.</p>
    </div>
    <div id="step-div">
      <p>3-of-3 Scheme</p>
    </div>
    <div id="para-div">
      <p>This time Alice wants to backup her secret pin by splitting the pin into three parts (<span class="bold">k</span> = 
        <span class="hi-blue">3</span>) and sharing each part with one of her three friends Bob, Charlie and Dave. Note that
        Alice could have shared a fourth and a fifth part with two friends Eva and Frank. This would be the
        <span class="bold">3-of-5</span> schema, with <span class="bold">k = 3</span> as the threshold. In other words, Alice
      would need any three of the five parts to reconstruct her secret pin.</p>
      <p>Per <span class="bold">Shamir's Secret Sharing</span> schema, this implies a <span class="bold">polynomial</span>
        equation of degree <span class="bold">(k - 1)</span> = <span class="hi-blue">2</span>.</p>
    </div>
    <div id="para-div">
      <p>A <span class="bold">polynomial</span> of degree <span class="bold">2</span> is a <span class="bold">quadratic</span>
        equation of the form:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-05.png" class="img-cls" alt="Quadratic" />
      <div class="img-cap">Equation.5</div>
    </div>
    <div id="para-div">
      <p>where <span class="bold">a<sub>0</sub></span>, <span class="bold">a<sub>1</sub></span>, and <span class="bold">a
        <sub>2</sub></span> are the coefficients of the second-degree <span class="bold">polynomial</span> (a quadratic
        equation).</p>
    </div>
    <div id="para-div">
      <p>Since <span class="bold">f(0)</span> is the secret <span class="bold">1420</span>, we can deduce the value for
        the coefficient <span class="bold">a<sub>0</sub></span> = <span class="bold">1420</span> and write the equation
        as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-06.png" class="img-cls" alt="Quadratic" />
      <div class="img-cap">Equation.6</div>
    </div>
    <div id="para-div">
      <p>Let us say, Alice picks random values for the coefficients <span class="bold">a<sub>1</sub></span> = <span
        class="hi-blue">40</span> and <span class="bold">a<sub>2</sub></span> = <span class="hi-blue">20</span> to arrive
        at the final equation as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-07.png" class="img-cls" alt="Quadratic" />
      <div class="img-cap">Equation.7</div>
    </div>
    <div id="para-div">
      <p>Substituting <span class="bold">x</span> = <span class="bold">1</span>, we get <span class="bold">f(1)</span>
        = <span class="hi-blue">1480</span>, for <span class="bold">x</span> = <span class="bold">2</span>, we get
        <span class="bold">f(2)</span> = <span class="hi-blue">1580</span>, for <span class="bold">x</span> =
        <span class="bold">3</span>, we get <span class="bold">f(3)</span> = <span class="hi-blue">1720</span> and so on.
        The points (1, 1480), (2, 1580), (3, 1720), etc., all lie along the path of the Equation.7 from above.</p>
    </div>
    <div id="para-div">
      <p>Alice can now share the value <span class="hi-yellow">1580</span> with Bob, the value <span class="hi-yellow">1480</span>
        with Charlie, and the value <span class="hi-yellow">1720</span> with Dave for safe-keeping. Alice will retain the information
        of the <span class="bold">x</span> values corresponding to the parts shared with Bob, Charlie, and Dave.</p>
    </div>
    <div id="para-div">
      <p>To restore the original secret pin, Alice will get the value <span class="bold">1580</span> from Bob, the value
        <span class="bold">1480</span> from Charlie, and the value <span class="bold">1720</span> from Dave and plug the values
        into the Equation.5 along with the corresponding <span class="bold">x</span> values [(x=3, f(3)=1720), (x=2, f(2)=1580),
      (x=1, f(1)=1480)] to arrive at the following system of equations:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-08.png" class="img-cls" alt="Equations" />
      <div class="img-cap">Equation.8</div>
    </div>
    <div id="para-div">
      <p>Solving the equations <span class="bold">(1)</span>, <span class="bold">(2)</span>, and <span class="bold">(3)</span>
        from above, we can deduce the value for the coefficient <span class="bold">a<sub>0</sub></span> = <span class="bold">1420</span>,
        the value for the coefficient <span class="bold">a<sub>1</sub></span> = <span class="bold">40</span> and the value for
        coefficient <span class="bold">a<sub>2</sub></span> = <span class="bold">20</span>.</p>
    </div>
    <div id="para-div">
      <p>Plugging the value of these coefficients into the Equation.5, Alice will be able to arrive at the equation that is
        the same as Equation.7 from above. The value for <span class="bold">f(0)</span> represents the original secret pin.</p>
    </div>
    <div id="step-div">
      <p>k-of-n Scheme</p>
    </div>
    <div id="para-div">
      <p>In general, if Alice wants to backup her secret by splitting the it into <span class="bold">k</span> parts, then this
        implies a <span class="bold">polynomial</span> equation of degree <span class="bold">(k-1)</span> of the form:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-09.png" class="img-cls" alt="Polynomial" />
      <div class="img-cap">Equation.9</div>
    </div>
    <div id="para-div">
      <p>Since <span class="bold">f(0)</span> will be the secret, we can deduce the value for the coefficient
        <span class="bold">a<sub>0</sub></span> to be the <span class="bold">secret</span>. Then, Alice will pick random values
        for all the remaining coefficients <span class="bold">a<sub>1</sub></span> through <span class="bold">a<sub>(k-1)</sub>.</p>
    </div>
    <div id="para-div">
      <p>Substituting different values for <span class="bold">x</span>, Alice can pick a set of <span class="bold">k</span> parts
        [(a, f(a)), (b, f(b)), ... (k, f(k))] and store those parts in <span class="bold">k</span> different secure locations.</p>
    </div>
    <div id="para-div">
      <p>Then comes the fun part when reconstructing the original <span class="bold">secret</span>. To restore the original
        <span class="bold">secret</span>, one can substitute each of the points [(a, f(a)), (b, f(b)), ... (k, f(k))] into the
        Equation.9 and solve the <span class="bold">k</span> different system of equations to determine the values of the
        coefficients <span class="bold">a<sub>0</sub></span> through <span class="bold">a<sub>(k-1)</sub></span>. This is the
        approach we took for the two cases we explored (2-of-2 and 3-of-3 schemes). There is another approach called
        <span class="hi-yellow">Lagrange Polynomial Interpolation</span> for reconstructing the original polynomial.</p>
    </div>
    <div id="para-div">
      <p>Given <span class="bold">k</span> points, the general form of <span class="bold">Lagrange Polynomial Interpolation</span>
        is as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-10.png" class="img-cls" alt="Lagrange"/>
      <div class="img-cap">Equation.10</div>
    </div>
    <div id="para-div">
      <p>where <span class="bold">L<sub>i</sub>(x)</span> is as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-11.png" class="img-cls" alt="Lagrange"/>
      <div class="img-cap">Equation.11</div>
    </div>
    <div id="para-div">
      <p>Let us apply <span class="bold">Lagrange Polynomial Interpolation</span> to our example from the 2-of-2 scheme.</p>
    </div>
    <div id="para-div">
      <p>From our 2-of-2 scheme example, the <span class="bold">2</span> points are as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-12.png" class="img-cls" alt="Points"/>
      <div class="img-cap">Equation.12</div>
    </div>
    <div id="para-div">
      <p>Given the <span class="bold">2</span> points, the equation for <span class="bold">Lagrange Polynomial Interpolation</span>
        is as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-13.png" class="img-cls" alt="Lagrange of 2"/>
      <div class="img-cap">Equation.13</div>
    </div>
    <div id="para-div">
      <p>Substituting the values for <span class="bold">f(x<sub>0</sub>)</span> and <span class="bold">f(x<sub>1</sub>)</span> into
        the Equation.13 from above, we get:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-14.png" class="img-cls" alt="Lagrange of 2"/>
      <div class="img-cap">Equation.14</div>
    </div>
    <div id="para-div">
      <p>The value for <span class="bold">L<sub>0</sub>(x)</span> can be computed as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-15.png" class="img-cls" alt="Lagrange L0"/>
      <div class="img-cap">Equation.15</div>
    </div>
    <div id="para-div">
      <p>Similaryly, the value for <span class="bold">L<sub>1</sub>(x)</span> can be computed as follows:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-16.png" class="img-cls" alt="Lagrange L1"/>
      <div class="img-cap">Equation.16</div>
    </div>
    <div id="para-div">
      <p>Substituting the values for <span class="bold">L<sub>0</sub>(x)</span> and <span class="bold">L<sub>1</sub>(x)</span> into
        the Equation.14 from above, we get:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-17.png" class="img-cls" alt="Lagrange of 2"/>
      <div class="img-cap">Equation.17</div>
    </div>
    <div id="para-div">
      <p>Expanding and simplifying the Equation.17 from above, we get:</p>
    </div>
    <div id="img-outer-div"> <img src="./images/Equation-18.png" class="img-cls" alt="Lagrange Final"/>
      <div class="img-cap">Equation.18</div>
    </div>
    <div id="para-div">
      <p><span class="bold">BINGO</span> !!! This is the same as the Equation.3 that Alice started with.</p>
    </div>
    <div id="step-div">
      <p>Practical Application</p>
    </div>
    <div id="para-div">
      <p>We started with the premise that Alice wants to securely split her <span class="bold">Bitcoin</span> private
        key into unique parts and backup those parts in different secure locations for safe-keeping.</p>
      <p>We then went on to unravel the approach to <span class="bold">Key Sharding</span> using one of the popular
        algorithm's called <span class="bold">Shamir's Secret Sharing</span>.</p>
      <p>In this section, we will demonstrate <span class="bold">Key Sharding</span> using one of the <span class="bold">
        Python</span> modules called <span class="hi-yellow">secretsharing</span>.</p>
      <p>To install the <span class="bold">Python</span> module <span class="bold">secretsharing</span>, open a terminal
        window and execute the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ pip install secretsharing</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.1</h4>
      <pre>Collecting secretsharing
  Downloading https://files.pythonhosted.org/packages/d3/53/97909e19fe623c6dfdb7f881c1ec119627c34419d973d094e002738fd984/secretsharing-0.2.6.tar.gz
Building wheels for collected packages: secretsharing
  Running setup.py bdist_wheel for secretsharing ... done
  Stored in directory: /root/.cache/pip/wheels/09/c6/4a/c97772071806a92c6e60a6aa5811dfb25c909ca29f37b03127
Successfully built secretsharing
Installing collected packages: secretsharing
Successfully installed secretsharing-0.2.6</pre>
    </div>
    <div id="para-div">
      <p>Next, start <span class="bold">Python</span>'s REPL by executing the following command:</p>
    </div>
    <div id="cmd-div">
      <p>$ python</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.2</h4>
      <pre>Python 2.7.15rc1 (default, Apr 15 2018, 21:51:34) 
[GCC 7.3.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt;</pre>
    </div>
    <div id="para-div">
      <p>For this demonstration, let us assume Alice's <span class="bold">Bitcoin</span> private key is 
        <span class="hi-yellow">cU1BVGodVHwP7BrSQhdHMLzugxr1a1Wq3CS5PzJ1V3L68krfd5D8</span>.</p>
    </div>
    <div id="warn-div">
      <h4>WARNING</h4>
      <pre>Never ever share your Bitcoin private key.</pre>
    </div>
    <div id="para-div">
      <p>We will use the <span class="bold">3-of-5</span> threshold scheme for this demonstration.</p>
    </div>
    <div id="para-div">
      <p>To split the <span class="bold">Bitcoin</span> private key, execute the following <span class="bold">
        Python</span> code:</p>
    </div>
    <div id="cmd-div">
      <p>&gt;&gt;&gt; from secretsharing import BitcoinToB58SecretSharer</p>
      <p>&gt;&gt;&gt; parts = BitcoinToB58SecretSharer.split_secret("cU1BVGodVHwP7BrSQhdHMLzugxr1a1Wq3CS5PzJ1V3L68krfd5D8", 3, 5)</p>
      <p>&gt;&gt;&gt; parts</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.3</h4>
      <pre>['2-29MZK9DCsXSjtUYU8aB3Puo3HLecrF9HDvWo7gdFf2CS5T5XnRGVJ5s', '3-CzbwpHTgc1aMPBMCcaLpEgPkqfdsKowcvLNwG2oaDYBxVDqti77KRMp', '4-87EeRSktAyAaywsfvpnNRDxWCNjnJKoK8yse3Nor9dpC1MMM8Unzyko', '5-CvmngcGqsh5BUt3WnMf4kFcHB561s1KdqdYj3pSayXEzu8dmSyieSYz', '6-21hF3nqXQtSQ5sw6U8oYR4E5x9YuvduK4WrNhFuHAzJWuGfHGAV9LUD']</pre>
    </div>
    <div id="para-div">
      <p>Alice can now share the three parts as follows:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="bold">Bob</span>: '2-29MZK9DCsXSjtUYU8aB3Puo3HLecrF9HDvWo7gdFf2CS5T5XnRGVJ5s'</p>
        </li>
        <li>
          <p><span class="bold">Charlie</span>: '4-87EeRSktAyAaywsfvpnNRDxWCNjnJKoK8yse3Nor9dpC1MMM8Unzyko'</p>
        </li>
        <li>
          <p><span class="bold">Dave</span>: '6-21hF3nqXQtSQ5sw6U8oYR4E5x9YuvduK4WrNhFuHAzJWuGfHGAV9LUD'</p>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>To reconstruct the <span class="bold">Bitcoin</span> private key from the parts shared with Bob, Charlie, and Dave,
        execute the following <span class="bold">Python</span> code:</p>
    </div>
    <div id="cmd-div">
      <p>&gt;&gt;&gt; BitcoinToB58SecretSharer.recover_secret(['2-29MZK9DCsXSjtUYU8aB3Puo3HLecrF9HDvWo7gdFf2CS5T5XnRGVJ5s', '4-87EeRSktAyAaywsfvpnNRDxWCNjnJKoK8yse3Nor9dpC1MMM8Unzyko', '6-21hF3nqXQtSQ5sw6U8oYR4E5x9YuvduK4WrNhFuHAzJWuGfHGAV9LUD'])</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.4</h4>
      <pre>'cU1BVGodVHwP7BrSQhdHMLzugxr1a1Wq3CS5PzJ1V3L68krfd5D8'</pre>
    </div>
    <div id="para-div">
      <p><span class="bold">Hooray</span> !!! We have successfully demonstrated the concept of <span class="bold">
        Key Sharding</span> using <span class="bold">Shamir's Secret Sharing</span> algorithm.</p>
    </div>
    <br/>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
