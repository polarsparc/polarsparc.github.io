<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="Web Applications using Python Flask - Part I">
    <meta name="subject" content="Web Applications using Python Flask - Part I">
    <meta name="keywords" content="python, flask">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>Web Applications using Python Flask - Part I</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br />
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>Web Applications using Python Flask - Part I</p>
    </div>
    <br/>
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">08/30/2021</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" />
    <br/>
    <div id="section-div">
      <p>Overview</p>
    </div>
    <div id="para-div">
      <p><span class="hi-yellow">Flask</span> is an elegant, popular, and simple micro-framework for building web applications in
        <span class="bold">Python</span>.</p>
    </div>
    <br/>
    <div id="section-div">
      <p>Installation and Setup</p>
    </div>
    <div id="para-div">
      <p>Installation and setup will be on a Linux desktop running Ubuntu 20.04 LTS. Note that the stable Python version on Ubuntu is
        <span class="bold">3.8</span>. Also, we will assume the logged in user is <span class="bold">alice</span> with the home
        directory located at <span class="bold">/home/alice</span>.</p>
    </div>
    <div id="para-div">
      <p>For our demonstration, we will create a directory called <span class="bold">MyFlask</span> under the users home directory by
        executing the following command in a terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ mkdir -p $HOME/MyFlask</p>
    </div>
    <div id="para-div">
      <p>Next, we will create a project specific Python virtual environment using the <span class="hi-yellow">venv</span> module. In
        order to do that, we first need to install the package for <span class="bold">venv</span> by executing the following command
        in a terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ sudo apt install python3.8-venv</p>
    </div>
    <div id="para-div">
      <p>The Python <span class="bold">venv</span> module allows one to create a lightweight virtual environments, each with its own
        directory structure, that are isolated from the system specific directory structure. To create a Python virtual environment,
        execute the following command(s) in the terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ cd $HOME/MyFlask</p>
      <p>$ python3 -m venv venv</p>
    </div>
    <div id="para-div">
      <p>This will create a directory called <span class="bold">venv</span> under the current directory. On needs to activate the
        newly created virtual environment by executing the following command in the terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ source venv/bin/activate</p>
    </div>
    <div id="para-div">
      <p>On successful virtual environment activation, the prompt will be prefixed with <span class="hi-grey">(venv)</span>.</p>
    </div>
    <div id="para-div">
      <p>We will now install the following Python modules:</p>
      <ul id="blue-sqr-ul">
        <li><p><span class="hi-yellow">flask</span> :: the micro-framework for web development</p></li>
        <li><p><span class="hi-yellow">jinja2</span> :: the fast, expressive, and extensible templating engine</p></li>
        <li><p><span class="hi-yellow">gunicorn</span> :: the HTTP web server</p></li>
        <li><p><span class="hi-yellow">sqlalchemy</span> :: the popular SQL database abstraction layer</p></li>
      </ul>
      <p>Execute the following command(s) in the terminal window (with venv activated):</p>
    </div>
    <div id="cmd-div">
      <p>$ pip install flask jinja2 gunicorn sqlalchemy</p>
    </div>
    <div id="para-div">
      <p>Next, we will install a small, fast, self-contained, highly-reliable, full-featured, open-source SQL database engine called
        <span class="hi-yellow">sqlite</span> by executing the following command in a terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ sudo apt install sqlite3</p>
    </div>
    <div id="para-div">
      <p>For our web application, we will create a <span class="bold">flask</span> project directory called <span class="bold">
        SecureNotes</span> under the directory <span class="bold">MyFlask</span> by executing the following command(s) in the
        terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ mkdir -p $HOME/MyFlask/SecureNotes</p>
      <p>$ mkdir -p $HOME/MyFlask/SecureNotes/config</p>
      <p>$ mkdir -p $HOME/MyFlask/SecureNotes/db</p>
      <p>$ mkdir -p $HOME/MyFlask/SecureNotes/model</p>
      <p>$ mkdir -p $HOME/MyFlask/SecureNotes/static/images</p>
      <p>$ mkdir -p $HOME/MyFlask/SecureNotes/templates</p>
    </div>
    <br/>
    <div id="section-div">
      <p>Hands-on Python Flask</p>
    </div>
    <div id="para-div">
      <p>The following is the Python script called <span class="hi-yellow">config.py</span> that will be located in the directory
        <span class="bold">SecureNotes/config</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">config.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from flask import Flask

app_name = 'SecureNotes'

app = Flask(app_name)</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">config.py</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="hi-yellow">WSGI</span> :: stands for Web Server Gateway Interface that defines a well-defined standard
            interface for executing Python applications via the web server. Note that the regular web servers have no way of executing
            any Python code. The standrad WSGI interface could be implemented by any web server provider as a module for intercepting
            and routing the web requests to a WSGI server that can invoke any Python code in a standard way. In other words, WSGI has
            two sides - the server side that is implemented as an extension by the web server provider and the application side that
            is implemented like a middleware for executing the Python application code</p>
          <p>The following illustration shows the high-level architectural components of WSGI:</p>
          <div id="img-outer-div"> <img alt="WSGI Components" src="./images/Flask-01.png" class="img-cls" />
            <div class="img-cap">Figure.1</div>
          </div>
          <br/>
        </li>
        <li><p><span class="hi-yellow">View Function</span> :: is the method that will respond to request in a web application. It
          returns content that flask will return as the outgoing response</p></li>
        <li><p><span class="hi-yellow">Flask</span> :: an object that implements the WSGI interface and acts as the core object. It
          is passed the name of the module or package of the application. Once an instance is created, it acts as a central registry
          for all the view functions and much more. Flask uses the passed in name argument to determine the root directory path of
          the application so that it can be used to find resource files relative to the location of the web application</p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>The following is the Python script called <span class="hi-yellow">main.py</span> that will be located in the directory
        <span class="bold">SecureNotes</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">main.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from config.config import app

def index():
    return '&lt;h3&gt;Welcome to SecureNotes&lt;/h3&gt;'

app.add_url_rule('/', view_func=index)</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">main.py</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li><p><span class="hi-yellow">index()</span> :: defines the view function that returns some basic HTML text</p></li>
        <li><p><span class="hi-yellow">app.add_url_rule(...)</span> :: the method that allows one to register a view function that
          corresponds to a URL path. In our case, the view function <span class="bold">index()</span> will be invoked when the web
          client (such as a browser accesses the URL path '/' on the web server</p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>To test our the Python Flask web application, we need to start the <span class="bold">gunicorn</span> web server, which will
        connect with the WSGI enabled Flask application by executing the following command in the venv terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ gunicorn --bind '127.0.0.1:8080' main:app</p>
    </div>
    <div id="para-div">
      <p>The first option of the command specifies the ip address and port to bind the web server to. The second option of the command
        specifies the Flask application module (which is <span class="hi-blue">main</span> in our case) and the Flask object within
        the application module (which is <span class="hi-blue">app</span> in our case that implements the WSGI middleware).</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.1</h4>
      <pre>[2021-08-30 12:27:18 -0400] [14826] [INFO] Starting gunicorn 20.1.0
[2021-08-30 12:27:18 -0400] [14826] [INFO] Listening at: http://127.0.0.1:8080 (14826)
[2021-08-30 12:27:18 -0400] [14826] [INFO] Using worker: sync
[2021-08-30 12:27:18 -0400] [14828] [INFO] Booting worker with pid: 14828</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Launch a browser and access the URL <span class="bold">http://127.0.0.1:8080/</span>. The following illustration shows the
        response on the browser:</p>
    </div>
    <div id="img-outer-div"> <img alt="Request from Browser" src="./images/Flask-02.png" class="img-cls" />
      <div class="img-cap">Figure.2</div>
    </div>
    <br/>
    <div id="para-div">
      <p>The following is the modified version of the Python script <span class="bold">main.py</span> that is functionally the same
        as the previous case, except that it makes use of Flask defined Python decorator:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">main.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from config.config import app

@app.route('/')
def index():
    return '&lt;h3&gt;Welcome to SecureNotes&lt;/h3&gt;'</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">main.py</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li><p><span class="hi-yellow">@app.route(...)</span> :: the decorator that allows one to register the decorated method as
          the view function that corresponds to the specified URL path '/'. This is a more elegant way of registering view functions
          corresponding to the various URLs instead of using the <span class="bold">app.add_url_rule(...)</span> method. Going
          forward, we will use this approach to register view functions</p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>We will now move into the next phase of introducing HTML web content into Flask.</p>
    </div>
    <div id="para-div">
      <p>The following is the HTML page called <span class="hi-yellow">welcome.html</span> that will be located in the directory
        <span class="bold">SecureNotes/templates</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">welcome.html</div>
      <div class="src-body-1">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;Welcome to Secure Notes&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h3&gt;Welcome to Secure Notes&lt;/h3&gt;
        &lt;p&gt;This is a demo app using Flask&lt;/p&gt;
        &lt;br/&gt;
        &lt;hr/&gt;
        &lt;p style="text-align:center;"&gt;&lt;img src="static/images/polarsparc.png" alt="PolarSPARC"&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>The following is the modified version of the Python script <span class="bold">config.py</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">config.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from flask import Flask
import logging

app_name = 'SecureNotes'

app = Flask(app_name)

gunicorn_logger = logging.getLogger('gunicorn.error')
app.logger.handlers = gunicorn_logger.handlers
app.logger.setLevel(gunicorn_logger.level)

app.logger.debug('Flask application root path: %s' % app.root_path)
app.logger.debug('Flask application static folder: %s' % app.static_folder)
app.logger.debug('Flask application template folder: %s' % os.path.join(app.root_path, app.template_folder))</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">config.py</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li><p><span class="hi-yellow">logging.getLogger('gunicorn.error')</span> :: get the Logger object for <span class="bold">
          gunicorn</span></p></li>
        <li><p><span class="hi-yellow">app.logger.handlers = gunicorn_logger.handlers</span> :: associates the Flask application log
          handler with the log handler of <span class="bold">gunicorn</span> so the logs for the Flask application appears along with
          <span class="bold">gunicorn</span>'s logs</p></li>
        <li><p><span class="hi-yellow">app.logger.setLevel(gunicorn_logger.level)</span> :: sets the Flask application logging level
          to be the same as the one for <span class="bold">gunicorn</span> so the logs are consistent</p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>The following is the modified version of the Python script <span class="bold">main.py</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">main.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from flask.templating import render_template
from config.config import app

@app.route('/')
def index():
    return render_template('welcome.html')</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">main.py</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li><p><span class="hi-yellow">render_template(...)</span> :: returns the contents of the specified HTML file from the
          template directory located at <span class="bold">SecureNotes/templates</span></p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>To test our the Python Flask web application, start the <span class="bold">gunicorn</span> web server by executing the
        following command in the venv terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ gunicorn --bind '127.0.0.1:8080' --workers=2 --log-level=debug main:app</p>
    </div>
    <div id="para-div">
      <p>The second option of the command specifies the the number of worker processes to use to handle the web server requests. The
        third option of the command indicates the logging level to use.</p>
    </div>
    <div id="para-div">
      <p>The following would be a typical output:</p>
    </div>
    <div id="out-div">
      <h4>Output.2</h4>
      <pre>[2021-08-30 15:04:19 -0400] [18347] [DEBUG] Current configuration:
  config: ./gunicorn.conf.py
  wsgi_app: None
  bind: ['127.0.0.1:8080']
  backlog: 2048
  workers: 2
  worker_class: sync
  threads: 1
  worker_connections: 1000
  max_requests: 0
  max_requests_jitter: 0
  timeout: 30
  graceful_timeout: 30
  keepalive: 2
  limit_request_line: 4094
  limit_request_fields: 100
  limit_request_field_size: 8190
  reload: False
  reload_engine: auto
  reload_extra_files: []
  spew: False
  check_config: False
  print_config: False
  preload_app: False
  sendfile: None
  reuse_port: False
  chdir: /home/alice/MyFlask/SecureNotes
  daemon: False
  raw_env: []
  pidfile: None
  worker_tmp_dir: None
  user: 1000
  group: 1000
  umask: 0
  initgroups: False
  tmp_upload_dir: None
  secure_scheme_headers: {'X-FORWARDED-PROTOCOL': 'ssl', 'X-FORWARDED-PROTO': 'https', 'X-FORWARDED-SSL': 'on'}
  forwarded_allow_ips: ['127.0.0.1']
  accesslog: None
  disable_redirect_access_to_syslog: False
  access_log_format: %(h)s %(l)s %(u)s %(t)s "%(r)s" %(s)s %(b)s "%(f)s" "%(a)s"
  errorlog: -
  loglevel: debug
  capture_output: False
  logger_class: gunicorn.glogging.Logger
  logconfig: None
  logconfig_dict: {}
  syslog_addr: udp://localhost:514
  syslog: False
  syslog_prefix: None
  syslog_facility: user
  enable_stdio_inheritance: False
  statsd_host: None
  dogstatsd_tags: 
  statsd_prefix: 
  proc_name: None
  default_proc_name: main:app
  pythonpath: None
  paste: None
  on_starting: &lt;function OnStarting.on_starting at 0x7f951d4aa790&gt;
  on_reload: &lt;function OnReload.on_reload at 0x7f951d4aa8b0&gt;
  when_ready: &lt;function WhenReady.when_ready at 0x7f951d4aa9d0&gt;
  pre_fork: &lt;function Prefork.pre_fork at 0x7f951d4aaaf0&gt;
  post_fork: &lt;function Postfork.post_fork at 0x7f951d4aac10&gt;
  post_worker_init: &lt;function PostWorkerInit.post_worker_init at 0x7f951d4aad30&gt;
  worker_int: &lt;function WorkerInt.worker_int at 0x7f951d4aae50&gt;
  worker_abort: &lt;function WorkerAbort.worker_abort at 0x7f951d4aaf70&gt;
  pre_exec: &lt;function PreExec.pre_exec at 0x7f951d43f0d0&gt;
  pre_request: &lt;function PreRequest.pre_request at 0x7f951d43f1f0&gt;
  post_request: &lt;function PostRequest.post_request at 0x7f951d43f280&gt;
  child_exit: &lt;function ChildExit.child_exit at 0x7f951d43f3a0&gt;
  worker_exit: &lt;function WorkerExit.worker_exit at 0x7f951d43f4c0&gt;
  nworkers_changed: &lt;function NumWorkersChanged.nworkers_changed at 0x7f951d43f5e0&gt;
  on_exit: &lt;function OnExit.on_exit at 0x7f951d43f700&gt;
  proxy_protocol: False
  proxy_allow_ips: ['127.0.0.1']
  keyfile: None
  certfile: None
  ssl_version: 2
  cert_reqs: 0
  ca_certs: None
  suppress_ragged_eofs: True
  do_handshake_on_connect: False
  ciphers: None
  raw_paste_global_conf: []
  strip_header_spaces: False
[2021-08-30 15:04:19 -0400] [18347] [INFO] Starting gunicorn 20.1.0
[2021-08-30 15:04:19 -0400] [18347] [DEBUG] Arbiter booted
[2021-08-30 15:04:19 -0400] [18347] [INFO] Listening at: http://127.0.0.1:8080 (18347)
[2021-08-30 15:04:19 -0400] [18347] [INFO] Using worker: sync
[2021-08-30 15:04:19 -0400] [18349] [INFO] Booting worker with pid: 18349
[2021-08-30 15:04:19 -0400] [18350] [INFO] Booting worker with pid: 18350
[2021-08-30 15:04:19 -0400] [18347] [DEBUG] 2 workers
[2021-08-30 15:04:19 -0400] [18350] [DEBUG] Flask application root path: /home/bswamina/MyProjects/MyFlask/SecureNotes
[2021-08-30 15:04:19 -0400] [18350] [DEBUG] Flask application static folder: /home/bswamina/MyProjects/MyFlask/SecureNotes/static
[2021-08-30 15:04:19 -0400] [18350] [DEBUG] Flask application template folder: /home/bswamina/MyProjects/MyFlask/SecureNotes/templates
[2021-08-30 15:04:19 -0400] [18349] [DEBUG] Flask application root path: /home/bswamina/MyProjects/MyFlask/SecureNotes
[2021-08-30 15:04:19 -0400] [18349] [DEBUG] Flask application static folder: /home/bswamina/MyProjects/MyFlask/SecureNotes/static
[2021-08-30 15:04:19 -0400] [18349] [DEBUG] Flask application template folder: /home/bswamina/MyProjects/MyFlask/SecureNotes/templates</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Launch a browser and access the URL <span class="bold">http://127.0.0.1:8080/</span>. The following illustration shows the
        response on the browser:</p>
    </div>
    <div id="img-outer-div"> <img alt="Request from Browser" src="./images/Flask-03.png" class="img-cls" />
      <div class="img-cap">Figure.3</div>
    </div>
    <br/>
    <div id="para-div">
      <p>We will now move into the next phase by modifying the HTML page <span class="bold">welcome.html</span> into a login page and
        make it look more slick using <span class="hi-yellow"><a href="https://getbootstrap.com/" target="_blank">Bootstrap</span></a>
        </span>. Download <span class="hi-yellow">bootstrap.min.css</span> and save it in the directory located at <span class="bold">
        SecureNotes/static</span>.</p>
    </div>
    <div id="para-div">
      <p>The following is the modified version of the HTML page <span class="bold">welcome.html</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">welcome.html</div>
      <div class="src-body-1">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
        &lt;link rel="stylesheet" href="static/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;
        &lt;title&gt;Welcome to Secure Notes - Login&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="container"&gt;
            &lt;div class="alert alert-secondary" role="alert"&gt;
                &lt;div class="text-center"&gt;
                    &lt;h3&gt;Welcome to Secure Notes - Login&lt;/h3&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;form&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="emailInput"&gt;Email&lt;/label&gt;
                    &lt;input type="email" class="form-control" id="email" name="email" required placeholder="Enter email..."&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="passwordInput"&gt;Password&lt;/label&gt;
                    &lt;input type="password" class="form-control" id="password" name="password" required placeholder="Enter password..."&gt;
                &lt;/div&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;Login&lt;/button&gt;
            &lt;/form&gt;
            &lt;br/&gt;
            &lt;div class="alert alert-primary" role="alert"&gt;
                Don't have an account - &lt;a href="#" class="alert-link"&gt;Sign Up&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class="text-center"&gt;
                &lt;hr/&gt;
                &lt;img class="img-thumbnail" src="static/images/polarsparc.png" alt="PolarSPARC"&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/body&gt;
&lt;/html&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Restart the <span class="bold">gunicorn</span> server and launch a browser and access the URL <span class="bold">
        http://127.0.0.1:8080/</span>. The following illustration shows the response on the browser:</p>
    </div>
    <div id="img-outer-div"> <img alt="Request from Browser" src="./images/Flask-04.png" class="img-cls" />
      <div class="img-cap">Figure.4</div>
    </div>
    <br/>
    <div id="para-div">
      <p>This is looking much better now !!!</p>
    </div>
    <div id="para-div">
      <p>One can define all the options used to start the <span class="bold">gunicorn</span> server in a Python script called
        <span class="bold">gunicorn_config.py</span> that is located in the <span class="bold">SecureNotes/config</span> directory
        and use that to start the server:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">gunicorn_config.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

bind = ['127.0.0.1:8080']
workers = 2
reload = True
loglevel = 'debug'
wsgi_app = 'main:app'</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Going forward, one can start the <span class="bold">gunicorn</span> web server by executing the following command in the
        venv terminal window:</p>
    </div>
    <div id="cmd-div">
      <p>$ gunicorn --config config/gunicorn_config.py</p>
    </div>
    <div id="para-div">
      <p>We will now create a new HTML page for sign-up and link it from the HTML page <span class="bold">welcome.html</span>.</p>
    </div>
    <div id="para-div">
      <p>The following is the HTML sign-up page called <span class="hi-yellow">signup.html</span> that will be located in the directory
        <span class="bold">SecureNotes/templates</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">signup.html</div>
      <div class="src-body-1">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
        &lt;link rel="stylesheet" href="static/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;
        &lt;title&gt;Welcome to Secure Notes - Sign Up&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="container"&gt;
            &lt;div class="alert alert-secondary" role="alert"&gt;
                &lt;div class="text-center"&gt;
                    &lt;h3&gt;Welcome to Secure Notes - Sign Up&lt;/h3&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;form&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="emailInput"&gt;Email&lt;/label&gt;
                    &lt;input type="email" class="form-control" id="email" name="email" required placeholder="Enter email..."&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="passwordInput"&gt;Password&lt;/label&gt;
                    &lt;input type="password" class="form-control" id="password1" name="password1" required placeholder="Enter password..."&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="passwordInput"&gt;Confirm Password&lt;/label&gt;
                    &lt;input type="password" class="form-control" id="password2" name="password2" required placeholder="Confirm password..."&gt;
                &lt;/div&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;Register&lt;/button&gt;
            &lt;/form&gt;
            &lt;div class="text-center"&gt;
                &lt;hr/&gt;
                &lt;img class="img-thumbnail" src="static/images/polarsparc.png" alt="PolarSPARC"&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/body&gt;
&lt;/html&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>The following is the modified version of the HTML page <span class="bold">welcome.html</span> that links the HTML page
        <span class="bold">signup.html</span> via the URL <span class="hi-yellow">/signup</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">welcome.html</div>
      <div class="src-body-1">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
        &lt;link rel="stylesheet" href="static/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;
        &lt;title&gt;Welcome to Secure Notes - Login&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="container"&gt;
            &lt;div class="alert alert-secondary" role="alert"&gt;
                &lt;div class="text-center"&gt;
                    &lt;h3&gt;Welcome to Secure Notes - Login&lt;/h3&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;form&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="emailInput"&gt;Email&lt;/label&gt;
                    &lt;input type="email" class="form-control" id="email" name="email" required placeholder="Enter email..."&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="passwordInput"&gt;Password&lt;/label&gt;
                    &lt;input type="password" class="form-control" id="password" name="password" required placeholder="Enter password..."&gt;
                &lt;/div&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;Login&lt;/button&gt;
            &lt;/form&gt;
            &lt;br/&gt;
            &lt;div class="alert alert-primary" role="alert"&gt;
                Don't have an account - &lt;a href="/signup" class="alert-link"&gt;Sign Up&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class="text-center"&gt;
                &lt;hr/&gt;
                &lt;img class="img-thumbnail" src="static/images/polarsparc.png" alt="PolarSPARC"&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/body&gt;
&lt;/html&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>The following is the modified version of the Python script <span class="bold">main.py</span> to handle the URL endpoint for
        <span class="bold">/signup</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">main.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from flask.templating import render_template
from config.config import app

@app.route('/')
def index():
    return render_template('welcome.html')

@app.route('/signup')
def signup():
    return render_template('signup.html')</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Restart the <span class="bold">gunicorn</span> server and launch a browser and access the URL <span class="bold">
        http://127.0.0.1:8080/</span>. Once the login page loads, click on the 'Sign Up' link. The following illustration shows the
        response on the browser:</p>
    </div>
    <div id="img-outer-div"> <img alt="Sign Up from Browser" src="./images/Flask-05.png" class="img-cls" />
      <div class="img-cap">Figure.5</div>
    </div>
    <br/>
    <div id="para-div">
      <p>Note that when the 'Sign Up' link on the HTML page <span class="bold">welcome.html</span> is clicked on, it makes a HTTP
        GET request to the URL <span class="bold">/signup</span>, which is handled by the Flask application <span class="bold">
        main.py</span> in the method <span class="bold">signup()</span> to render the sign-up HTML page <span class="bold">
        signup.html</span> on the browser. Currently, when the 'Register' button on the HTML page <span class="bold">signup.html
        </span> is clicked, nothing happens. We will fix that so that it will make a HTTP POST of the form data to the URL at
        <span class="bold">/signup</span> and handled by the same method <span class="bold">signup()</span> in the main Flask
        application.</p>
    </div>
    <div id="para-div">
      <p>The following is the modified version of the HTML page <span class="bold">signup.html</span> to POST the form to the URL at
        <span class="hi-yellow">/signup</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">signup.html</div>
      <div class="src-body-1">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
        &lt;link rel="stylesheet" href="static/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;
        &lt;title&gt;Welcome to Secure Notes - Sign Up&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="container"&gt;
            &lt;div class="alert alert-secondary" role="alert"&gt;
                &lt;div class="text-center"&gt;
                    &lt;h3&gt;Welcome to Secure Notes - Sign Up&lt;/h3&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;form action="/signup" method="POST"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="emailInput"&gt;Email&lt;/label&gt;
                    &lt;input type="email" class="form-control" id="email" name="email" required placeholder="Enter email..."&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="passwordInput"&gt;Password&lt;/label&gt;
                    &lt;input type="password" class="form-control" id="password1" name="password1" required placeholder="Enter password..."&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="passwordInput"&gt;Confirm Password&lt;/label&gt;
                    &lt;input type="password" class="form-control" id="password2" name="password2" required placeholder="Confirm password..."&gt;
                &lt;/div&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;Register&lt;/button&gt;
            &lt;/form&gt;
            &lt;div class="text-center"&gt;
                &lt;hr/&gt;
                &lt;img class="img-thumbnail" src="static/images/polarsparc.png" alt="PolarSPARC"&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/body&gt;
&lt;/html&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of <span class="hi-yellow">action="/signup"</span> and <span class="hi-yellow">method="POST"</span>.</p>
    </div>
    <div id="para-div">
      <p>The following is the modified version of the Python script <span class="bold">main.py</span> to handle the HTTP POST request
        at the URL endpoint for <span class="bold">/signup</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">main.py</div>
      <div class="src-body-1">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   30 Aug 2021
#

from flask import request
from flask.templating import render_template
from config.config import app

@app.route('/')
def index():
    return render_template('welcome.html')

@app.route('/signup', methods=['GET', 'POST'])
def signup():
    if request.method == 'GET':
        return render_template('signup.html')
    email = None
    if 'email' in request.form:
        email = request.form['email']
    if email is None or len(email.strip()) == 0:
        return render_template('signup_error.html', message='Invalid email !!!')
    password1 = None
    if 'password1' in request.form:
        password1 = request.form['password1']
    if password1 is None or len(password1.strip()) == 0:
        return render_template('signup_error.html', message='Invalid password !!!')
    password2 = None
    if 'password2' in request.form:
        password2 = request.form['password2']
    if password1 != password2:
        return render_template('signup_error.html', message='Password confirmation failed !!!')
    return render_template('welcome.html')</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Some aspects of the <span class="bold">main.py</span> from the above needs a little explanation.</p>
      <ul id="blue-sqr-ul">
        <li><p><span class="hi-yellow">@app.route('/signup', methods=['GET', 'POST'])</span> :: the URL route decorator indicates
          the HTTP methods (GET and POST) this view function will handle</p></li>
        <li><p><span class="hi-yellow">request</span> :: when the Flask application handles a request, it creates a instance of the
          <span class="hi-yellow">flask.Request</span> object based on the environment it received from the WSGI server. Because a
          worker (coroutine, thread, or process) handles a single request at a time, the request data is considered global to that
          worker during that request. This is referred to as the request context. Flask automatically pushes the request context in
          the variable called <span class="hi-blue">request</span> to the view function that is handling the request. The request
          context is unique to each worker. The request context cannot be passed to another worker as the other worker will have a
          different context stack and will not know about the request the parent worker is pointing to. When the request ends,
          Flask will automatically pop the request context</p></li>
        <li><p><span class="hi-yellow">request.method</span> :: returns the HTTP method used in making the current request, such as
          GET, POST, PUT, DELETE, etc</p></li>
        <li><p><span class="hi-yellow">request.form</span> :: returns an immutable dictionary containing the key value pairs, where
          the keys contain all the name attributes of the input elements from the HTML form</p></li>
      </ul>
    </div>
    <div id="para-div">
      <p>Notice that we perform validation of the various input elements retrieved from the <span class="bold">request.form</span>
        dictionary. If any of the validation fails, we respond with a sign-up error HTML page.</p>
    </div>
    <div id="para-div">
      <p>The following is the HTML sign-up error page called <span class="hi-yellow">signup_error.html</span> that will be located
        in the directory <span class="bold">SecureNotes/templates</span>:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">signup_error.html</div>
      <div class="src-body-1">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
        &lt;link rel="stylesheet" href="static/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;
        &lt;title&gt;Welcome to Secure Notes - Sign Up Error&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="container"&gt;
            &lt;div class="alert alert-secondary" role="alert"&gt;
                &lt;div class="text-center"&gt;
                    &lt;h3&gt;Welcome to Secure Notes - Sign Up Error&lt;/h3&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;br/&gt;
            &lt;div class="alert alert-danger" role="alert"&gt;
                &lt;p&gt;{{ message }}&lt;/p&gt;
            &lt;/div&gt;
            &lt;br/&gt;
            &lt;span class="p-1 rounded-sm border border-primary"&gt;
                &lt;a href="/signup" class="alert-link"&gt;Sign Up&lt;/a&gt;
            &lt;/span&gt;
            &lt;div class="text-center"&gt;
                &lt;hr/&gt;
                &lt;img class="img-thumbnail" src="static/images/polarsparc.png" alt="PolarSPARC"&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/body&gt;
&lt;/html&gt;</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of the syntax <span class="hi-yellow">{{ message }}</span> in the HTML page above. This is the Jinja syntax 
        in action. The 'message' is the passed in variable whose value is substituted for when the response is returned back to the
        web client (the browser in our case).</p>
    </div>
    <div id="para-div">
      <p>Restart the <span class="bold">gunicorn</span> server and launch a browser and access the URL <span class="bold">
        http://127.0.0.1:8080/</span>. Once the login page loads, click on the 'Sign Up' link. When the sign-up page loads, enter
        the email-id, and different values for the password input and then click on the 'Register' button. The following illustration
        shows the response on the browser:</p>
    </div>
    <div id="img-outer-div"> <img alt="Sign Up Error from Browser" src="./images/Flask-06.png" class="img-cls" />
      <div class="img-cap">Figure.6</div>
    </div>
    <br/>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://flask.palletsprojects.com/en/2.0.x/" target="_blank"><span class="bold">Flask 2.0.x Documentation</span></a></p>
      <p><a href="https://getbootstrap.com/docs/5.1/getting-started/introduction/" target="_blank"><span class="bold">Bootstrap Documentation</span></a></p>
    </div>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
