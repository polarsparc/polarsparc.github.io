<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <title>More Pandas DataFrame</title>
    <link rel="stylesheet" type="text/css" href="../css/polarsparc-v1.0.css" />
  </head>
  <body> <br />
    <div id="title-div">
      <p>More Pandas DataFrame<br />
      </p>
    </div>
    <br />
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">02/13/2016</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" /> <br />
    <div id="section-div">
      <p>Introduction</p>
    </div>
    <div id="para-div">
      <p>In this article, we will explore the <span class="hi-yellow">merge</span>, the <span class="hi-yellow">groupby</span>, and
         the <span class="hi-yellow">pivot_table</span> functions of Pandas <span class="bold">DataFrame</span>.</p>
    </div>
    <div id="section-div">
      <p>Hands-on with Pandas DataFrame</p>
    </div>
    <div id="para-div">
      <p>Open a terminal window and fire off the <span class="bold">IPython Notebook</span>.</p>
      <p>To begin using <span class="bold">DataFrame</span>, one must import the <span class="hi-yellow">pandas</span> module as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>import numpy as np</p>
      <p>import pandas as pd</p>
    </div>
    <div id="para-div">
      <p>Notice we have also imported <span class="bold">numpy</span> as we will be using it.</p>
    </div>
    <div id="para-div">
      <p>Just as one can perform a join (inner or outer) on two (or more) database tables in SQL, one can perform a similar join operation on
        Pandas <span class="bold">DataFrame</span> using the <span class="hi-yellow">merge</span> function.</p>
    </div>
    <div id="para-div">
      <p>Let us create two simple <span class="bold">DataFrame</span>s called df1 and df2 to demostrate the <span class="bold">merge</span> function.</p>
    </div>
    <div id="para-div">
      <p>Create a simple 5 rows by 3 columns <span class="bold">DataFrame</span> called df1 as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df1 = pd.DataFrame({'name': ['Alice', 'Bob', 'Charlie', 'Don', 'Eva'], 'state': ['AZ', 'CA', 'DE', 'GA', 'NY'], 'age': [33, 41, 35, 29, 39]})</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-01.png" class="img-cls" />
      <div class="img-cap">Fig.1</div>
    </div>
    <div id="para-div">
      <p>Next, create another simple 5 rows by 2 columns <span class="bold">DataFrame</span> called df2 as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df2 = pd.DataFrame({'name': ['Alice', 'Bob', 'Charlie', 'Frank', 'John'], 'car': ['Acura', 'BMW', 'Chevy', 'Honda', 'Toyota']})</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-02.png" class="img-cls" />
      <div class="img-cap">Fig.2</div>
    </div>
    <div id="para-div">
      <p>To perform an inner join of the two <span class="bold">DataFrame</span>s called df1 and df2, invoke the <span class="bold">merge</span> function
        as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>pd.merge(df1, df2)</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-03.png" class="img-cls" />
      <div class="img-cap">Fig.3</div>
    </div>
    <div id="para-div">
      <p>The <span class="bold">merge</span> function on two <span class="bold">DataFrame</span>s defaults to an inner join operation.</p>
    </div>
    <div id="para-div">
      <p>One can specify the <span class="hi-green">how</span> parameter on the <span class="bold">merge</span> function to control the type of join
        operation. If the <span class="bold">how</span> parameter equals <span class="hi-yellow">left</span>, an outer join is performed with the keys
        from the <span class="bold">DataFrame</span> on the left. If the <span class="bold">how</span> parameter equals <span class="hi-yellow">right</span>,
        an outer join is performed with the keys from the <span class="bold">DataFrame</span> on the right. And finally, if the <span class="bold">how</span>
        parameter equals <span class="hi-yellow">outer</span>, an outer join is performed with the union of keys from both the <span class="bold">DataFrame</span>s.</p>
    </div>
    <div id="para-div">
      <p>To perform an outer join of the two <span class="bold">DataFrame</span>s called df1 and df2 with the keys from the <span class="bold">DataFrame</span>
        on the left (df1), invoke the <span class="bold">merge</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>pd.merge(df1, df2, how='left')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-04.png" class="img-cls" />
      <div class="img-cap">Fig.4</div>
    </div>
    <div id="para-div">
      <p>To perform an outer join of the two <span class="bold">DataFrame</span>s called df1 and df2 with the keys from the <span class="bold">DataFrame</span>
        on the right (df2), invoke the <span class="bold">merge</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>pd.merge(df1, df2, how='right')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-05.png" class="img-cls" />
      <div class="img-cap">Fig.5</div>
    </div>
    <div id="para-div">
      <p>To perform an outer join of the two <span class="bold">DataFrame</span>s called df1 and df2 with the union of keys from both the
        <span class="bold">DataFrame</span>s (df1 and df2), invoke the <span class="bold">merge</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>pd.merge(df1, df2, how='outer')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-06.png" class="img-cls" />
      <div class="img-cap">Fig.6</div>
    </div>
    <div id="para-div">
      <p>Just as one can perform aggregations (or transformations) on a database table in SQL using the group-by operation, one can perform similar aggregations
        (or transformations) on a Pandas <span class="bold">DataFrame</span> using the <span class="hi-yellow">groupby</span> function.</p>
    </div>
    <div id="para-div">
      <p>Let us create a fictitious call center activity dataset called <a href="./data/call_center.csv" target="_blank"><span class="bold">call_center.csv</span></a>.</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the top few records from the dataset:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-07.png" class="img-cls" />
      <div class="img-cap">Fig.7</div>
    </div>
    <div id="para-div">
      <p>Create a <span class="bold">DataFrame</span> called df3 by loading the fictitious call center activity dataset as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df3 = pd.read_csv('./call_center.csv')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the portion of the result from <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-08.png" class="img-cls" />
      <div class="img-cap">Fig.8</div>
    </div>
    <div id="para-div">
      <p>To aggregate and display the total number of customer calls handled by each call center agent by manager from the above <span class="bold">DataFrame</span>
        called df3, invoke the <span class="bold">groupby</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df3.groupby(['Manager', 'Agent']).count()</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-09.png" class="img-cls" />
      <div class="img-cap">Fig.9</div>
    </div>
    <div id="para-div">
      <p>The <span class="bold">groupby</span> function uses a 3 step process called split-apply-combine to perform the desired operation. In the first step,
        the data is split into groups according to the specified column(s). In the second step, the specified aggregate (or transformation) operation such as
        count(), sum(), mean(), var(), std(), etc., is applied to each group. Finally, in the third step, the results are combined for the groups.</p>
    </div>
    <div id="para-div">
      <p>To aggregate and display the total number of un-resolved customer calls by each call center agent by manager from the above <span class="bold">DataFrame</span>
        called df3, invoke the <span class="bold">groupby</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df3[df3.Resolved == 'N'].groupby(['Manager', 'Agent']).count()</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-10.png" class="img-cls" />
      <div class="img-cap">Fig.10</div>
    </div>
    <div id="para-div">
      <p>Now, let us create a fictitious household savings dataset called <a href="./data/savings.csv" target="_blank"><span class="bold">savings.csv</span></a>.</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the top few records from the dataset:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-11.png" class="img-cls" />
      <div class="img-cap">Fig.11</div>
    </div>
    <div id="para-div">
      <p>Create a <span class="bold">DataFrame</span> called df4 with <span class="bold">PersonID</span> as the index column by loading the fictitious household
        savings dataset as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df4 = pd.read_csv('./savings.csv', index_col='PersonID')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the portion of the result from <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-12.png" class="img-cls" />
      <div class="img-cap">Fig.12</div>
    </div>
    <div id="para-div">
      <p>Let us create a <span class="bold">groupby</span> object called gdf1 from the above <span class="bold">DataFrame</span> called df4 by invoking the
        <span class="bold">groupby</span> function on the <span class="bold">Education</span> column as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf1 = df4.groupby('Education')</p>
    </div>
    <div id="para-div">
      <p>To compute and display the average (mean) <span class="bold">Income</span>, <span class="bold">Debt</span>, and <span class="bold">NetWorth</span>
        by <span class="bold">Education</span> from the above <span class="bold">groupby</span> object called gdf1, invoke the <span class="bold">mean</span>
        function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf1['Income', 'Debt', 'NetWorth'].mean()</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-13.png" class="img-cls" />
      <div class="img-cap">Fig.13</div>
    </div>
    <div id="para-div">
      <p>Now, let us define a function to compute the <span class="hi-yellow">Z-Score</span> of a numeric column.</p>
      <p>Per Wikipedia, a <span class="bold">Z-Score</span> is a statistical measurement of a score's relationship to the mean in a group of scores.
        A <span class="bold">Z-Score</span> of 0 means the score is the same as the mean. A <span class="bold">Z-Score</span> can also be either
        positive or negative, indicating whether it is above or below the mean and by how many standard deviations.</p>
    </div>
    <div id="para-div">
      <p>The following lambda function defines how to compute the <span class="bold">Z-Score</span> of a numeric column:</p>
    </div>
    <div id="cmd-div">
      <p>zscore = lambda x: (x - x.mean()) / x.std()</p>
    </div>
    <div id="para-div">
      <p>To compute and display the <span class="bold">Z-Score</span> on numeric columns <span class="bold">Income</span>, <span class="bold">Debt</span>,
        and <span class="bold">NetWorth</span> by <span class="bold">Education</span> from the above <span class="bold">groupby</span> object called gdf1,
        invoke the <span class="hi-green">transform</span> function specifying the above <span class="hi-yellow">zscore</span> lambda as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf1['Income', 'Debt', 'NetWorth'].transform(zscore).head()</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-14.png" class="img-cls" />
      <div class="img-cap">Fig.14</div>
    </div>
    <div id="para-div">
      <p>Now, let us create a <span class="bold">groupby</span> object called gdf2 from the above <span class="bold">DataFrame</span> called df4 by invoking the
        <span class="bold">groupby</span> function on the <span class="bold">Gender</span> and the <span class="bold">Education</span> columns as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf2 = df4.groupby(['Gender', 'Education'])</p>
    </div>
    <div id="para-div">
      <p>To compute and display the average (mean) <span class="bold">Income</span>, <span class="bold">Debt</span>, and <span class="bold">NetWorth</span>
        by <span class="bold">Gender</span> and <span class="bold">Education</span> from the above <span class="bold">groupby</span> object called gdf2,
        invoke the <span class="bold">mean</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf2['Income', 'Debt', 'NetWorth'].mean()</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-15.png" class="img-cls" />
      <div class="img-cap">Fig.15</div>
    </div>
    <div id="para-div">
      <p>To compute and display the standard deviation of <span class="bold">Income</span>, <span class="bold">Debt</span>, and <span class="bold">NetWorth</span>
        by <span class="bold">Gender</span> and <span class="bold">Education</span> from the above <span class="bold">groupby</span> object called gdf2,
        invoke the <span class="bold">std</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf2['Income', 'Debt', 'NetWorth'].std()</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-16.png" class="img-cls" />
      <div class="img-cap">Fig.16</div>
    </div>
    <div id="para-div">
      <p>To compute and display both the mean and standard deviation of <span class="bold">Income</span>, <span class="bold">Debt</span>, and <span class="bold">NetWorth</span>
        by <span class="bold">Gender</span> and <span class="bold">Education</span> from the above <span class="bold">groupby</span> object called gdf2,
        invoke the <span class="hi-green">agg</span> function by passing a dictionary of the mean() and std() operations as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>gdf2['Income'].agg({'mean' : np.mean, 'standard-deviation' : np.std})</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result in <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-17.png" class="img-cls" />
      <div class="img-cap">Fig.17</div>
    </div>
    <div id="para-div">
      <p>Often times we want to slice and dice a given tabular data into a different view. For example, given our household savings dataset, we may want a view
        of the averages (mean) <span class="bold">NetWorth</span> for different <span class="bold">Employment</span> types across different <span class="bold">Education</span>
        levels.</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the desired view from the original household savings view:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-18.png" class="img-cls" />
      <div class="img-cap">Fig.18</div>
    </div>
    <div id="para-div">
      <p>This is where the <span class="hi-yellow">Pivot</span> tables come into play. <span class="bold">Pivot</span> tables are created from a given
        <span class="bold">DataFrame</span> using the <span class="hi-green">pivot_table</span> function.</p>
    </div>
    <div id="para-div">
      <p>To create a <span class="bold">Pivot</span> table of averages (mean) <span class="bold">NetWorth</span> for different <span class="bold">Education</span>
        levels (columns) for each <span class="bold">Employment</span> type (rows) from the above <span class="bold">DataFrame</span> called df4, invoke the
        <span class="bold">pivot_table</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df4.pivot_table(index='Employment', columns='Education', values='NetWorth')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result from <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-19.png" class="img-cls" />
      <div class="img-cap">Fig.19</div>
    </div>
    <div id="para-div">
      <p>The <span class="bold">pivot_table</span> function takes 3 parameters - index (which indicates the keys of the pivot), columns of the pivot, and values
        (columns to aggregate on).</p>
      <p>By default, the <span class="bold">pivot_table</span> function uses <span class="bold">np.mean()</span> for the aggregation operation.</p>
    </div>
    <div id="para-div">
      <p>To create a <span class="bold">Pivot</span> table of averages (mean) for both <span class="bold">Debt</span> and <span class="bold">NetWorth</span> for different
        <span class="bold">Education</span> levels (columns) for each <span class="bold">Employment</span> type (rows) from the above <span class="bold">DataFrame</span>
        called df4, invoke the <span class="bold">pivot_table</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df4.pivot_table(index='Employment', columns='Education', values=['Debt', 'NetWorth'])</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result from <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-20.png" class="img-cls" />
      <div class="img-cap">Fig.20</div>
    </div>
    <div id="para-div">
      <p>To create a <span class="bold">Pivot</span> table of averages (mean) <span class="bold">NetWorth</span> for different <span class="bold">Education</span>
        levels (columns) for each <span class="bold">Employment</span> and <span class="bold">Gender</span> comnination (rows) from the above
        <span class="bold">DataFrame</span> called df4, invoke the <span class="bold">pivot_table</span> function as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df4.pivot_table(index=['Employment', 'Gender'], columns='Education', values='NetWorth')</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result from <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-21.png" class="img-cls" />
      <div class="img-cap">Fig.21</div>
    </div>
    <div id="para-div">
      <p>To create a <span class="bold">Pivot</span> table of standard deviations for both <span class="bold">Debt</span> and <span class="bold">NetWorth</span> for
        different <span class="bold">Education</span> levels (columns) for each <span class="bold">Employment</span> and <span class="bold">Gender</span> comnination
        (rows) from the above <span class="bold">DataFrame</span> called df4, invoke the <span class="bold">pivot_table</span> function by specifying the additional
        <span class="hi-yellow">aggfunc</span> as shown below:</p>
    </div>
    <div id="cmd-div">
      <p>df4.pivot_table(index=['Employment', 'Gender'], columns='Education', values=['Debt', 'NetWorth'], aggfunc=np.std)</p>
    </div>
    <div id="para-div">
      <p>The following shows the screenshot of the result from <span class="bold">IPython</span>:</p>
    </div>
    <div id="img-outer-div"> <img alt="More Pandas DataFrame" src="./images/MorePandas-22.png" class="img-cls" />
      <div class="img-cap">Fig.22</div>
    </div>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://polarsparc.github.io/Python/IPython-Notebook.html" target="_blank"><span class="bold">Introduction to IPython Notebook</span></a></p>
      <p><a href="https://polarsparc.github.io/Python/Exploring-NumPy.html" target="_blank"><span class="bold">Exploring NumPy</span></a></p>
      <p><a href="https://polarsparc.github.io/Python/Pandas-Series.html" target="_blank"><span class="bold">Exploring Pandas Series</span></a></p>
      <p><a href="https://polarsparc.github.io/Python/Pandas-DataFrame.html" target="_blank"><span class="bold">Exploring Pandas DataFrame</span></a></p>
    </div>
  </body>
</html>
