<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="Quick Primer on FastAPI">
    <meta name="subject" content="Quick Primer on FastAPI">
    <meta name="keywords" content="python, web">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>Quick Primer on FastAPI</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br/>
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>Quick Primer on FastAPI</p>
    </div>
    <br/>
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">10/05/2025</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr"/>
    <br/>
    <div id="section-div">
      <p>Overview</p>
    </div>
    <div id="para-div">
      <p><span class="hi-yellow">FastAPI</span> is a high performance Python web framework for building REST based API services.</p>
      <p>In this primer, we will demonstrate how one can setup and use the <span class="bold">FastAPI</span> web framework.</p>
    </div>
    <br/>
    <div id="section-div">
      <p>Installation and Setup</p>
    </div>
    <div id="para-div">
      <p>The installation and setup will be on a <span class="bold">Ubuntu 24.04 LTS</span> based Linux desktop. Ensure that <span
        class="bold">Python 3.x</span> programming language is installed and setup on the desktop.</p>
    </div>
    <div id="para-div">
      <p>To install the necessary <span class="bold">Python</span> packages, execute the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ pip install fastapi httpie python-jose uvicorn</p>
    </div>
    <br/>
    <div id="para-div">
      <p>For our demonstration, we will create a directory called <span class="bold">MyFastAPI</span> under the users home directory
        by executing the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ mkdir -p $HOME/MyFastAPI</p>
    </div>
    <br/>
    <div id="para-div">
      <p>This completes all the necessary installation and setup for the <span class="bold">FastAPI</span> hands-on demonstration.</p>
    </div>
    <br/>
    <div id="section-div">
      <p>Hands-on with FastAPI</p>
    </div>
    <br/>
    <div id="para-div">
      <p>In the following sections, we will get our hands dirty with the <span class="bold">FastAPI</span> framework. So, without
        further ado, let us get started !!!</p>
    </div>
    <div id="para-div">
      <p>The following is our first <span class="bold">FastAPI</span> Python code:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_1.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   28 Sep 2025
#

import logging
import uvicorn

from fastapi import FastAPI

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-01')

app = FastAPI()

@app.get('/')
async def index():
  logger.info('Calling index ...')
  return {'message': 'Welcome to MyFastAPI!'}

def main():
  logger.info('Starting web server on port 8000')
  uvicorn.run(app, host='192.168.1.25', port=8000)

if __name__ == '__main__':
  main()</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>To execute the above Python code, execute the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ python sample_1.py</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.1</h4>
      <pre>INFO 2025-10-04 21:28:42,447 - Starting web server on port 8000
INFO:     Started server process [61685]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://192.168.1.25:8000 (Press CTRL+C to quit)</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Open a terminal window and execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.2</h4>
      <pre>HTTP/1.1 200 OK
content-length: 35
content-type: application/json
date: Sun, 05 Oct 2025 01:29:47 GMT
server: uvicorn

{
  "message": "Welcome to MyFastAPI!"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>The code from <span class="bold">sample_1.py</span> above needs some explanation:</p>
      <p>An instance of the class <span class="hi-green">FastAPI</span> represents a web application and is captured by the Python
        variable <span class="bold">app</span> in the code.</p>
      <p>The <span class="bold">app</span> variable can be used as a Python URI path decorator by invoking the desired HTTP verb
        (get, post, put, delet, etc) to indicate to <span class="bold">FastAPI</span> that the HTTP request for that specific URI be
        routed to that specific Python handler function. In our example, the HTTP GET request on the URI "/" will be routed to the
        Python function <span class="hi-blue">index()</span>.</p>
      <p>The function <span class="hi-blue">ubvicorn.run()</span> takes as input an instance of <span class="bold">FastAPI</span>
        and launches a web server on the specifc host (<span class="bold">192.168.1.25</span>) on the port <span class="bold">8000
        </span>.</p>
    </div>
    <div id="para-div">
      <p>Next, the following is our second <span class="bold">FastAPI</span> Python code that demonstrates how one can organize and
        structure a group of related API endpoints into separate Python module(s).
        with different HTTP response types:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_2.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   28 Sep 2025
#

import logging

from fastapi import APIRouter

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-02')

router = APIRouter()

@router.get('/greet/{name}')
async def greet(name: str):
  logger.info('Calling greet with name ...')
  return {'message': 'Hello ' + name +' !'}

@router.get('/greet/spanish/{name}')
async def greet(name: str):
  logger.info('Calling greet in Spanish with name ...')
  return {'message': 'Hola ' + name +' !'}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>An instance of the class <span class="hi-green">APIRouter</span> represents a grouping of related API endpoint(s), which
        can be defined in separate Python module file(s) to manage complexity.</p>
    </div>
    <div id="para-div">
      <p>The following is our third <span class="bold">FastAPI</span> Python code that demonstrates how one can include related API
        endpoints that are defined in separate Python module file(s):</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_3.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   28 Sep 2025
#

import logging
import uvicorn

from fastapi import FastAPI

from MyFastAPI import sample_2

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-03')

app = FastAPI()
app.include_router(sample_2.router)

@app.get('/')
async def index():
  logger.info('Calling index ...')
  return {'message': 'Welcome to MyFastAPI!'}

def main():
  logger.info('Starting web server on port 8000')
  uvicorn.run(app, host='192.168.1.25', port=8000)

if __name__ == '__main__':
  main()</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of the call <span class="hi-blue">app.include_router()</span>, which includes router endpoint(s) defined in
        other Python module(s), such as the module <span class="bold">sample_2</span> in our example.</p>
    </div>
    <div id="para-div">
      <p>To execute the above Python code, execute the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ python sample_3.py</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The output would be similar to that of <span class="bold">Output.1</span> from above.</p>
    </div>
    <div id="para-div">
      <p>Open a terminal window and execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/greet/ada</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.3</h4>
      <pre>HTTP/1.1 200 OK
content-length: 25
content-type: application/json
date: Sun, 05 Oct 2025 19:35:05 GMT
server: uvicorn

{
  "message": "Hello ada !"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>In the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/greet/spanish/james</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.4</h4>
      <pre>HTTP/1.1 200 OK
content-length: 26
content-type: application/json
date: Sun, 05 Oct 2025 19:35:44 GMT
server: uvicorn

{
  "message": "Hola james !"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Moving along, the following is our fourth <span class="bold">FastAPI</span> Python code that demonstrates how one can raise
        HTTP exception(s):</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_4.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   28 Sep 2025
#

import logging

from fastapi import APIRouter, HTTPException, status

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-04')

router = APIRouter()

@router.get('/greet')
async def greet_1(name: str):
  logger.info('Calling greet ...')
  if name is None:
    raise HTTPException(status_code=status.HTTP_422_UNPROCESSABLE_CONTENT,
                        detail='Name cannot be None')
  return {'message': 'Hello ' + name +' !'}

@router.get('/greet/{name}')
async def greet_2(name: str):
  logger.info('Calling greet with name ...')
  return {'message': 'Hello ' + name +' !'}</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of the class <span class="hi-blue">HTTPException</span> to raise an exception with a specific HTTP status
        code and reason.</p>
    </div>
    <div id="para-div">
      <p>The following is our fifth <span class="bold">FastAPI</span> Python code which demonstrates how one can handle the HTTP
        exception(s) thrown from a handler function and send a JSON response back to the client:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_5.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   28 Sep 2025
#

import logging
import uvicorn

from fastapi import FastAPI, HTTPException
from starlette.responses import JSONResponse

from MyFastAPI import sample_4

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-05')

app = FastAPI()
app.include_router(sample_4.router)

@app.exception_handler(HTTPException)
async def http_exception_handler(request, exc):
  return JSONResponse(
    status_code=exc.status_code,
    content={
      'message': exc.detail,
    })

@app.get('/')
async def index():
  logger.info('Calling index ...')
  return {'message': 'Welcome to MyFastAPI!'}

def main():
  logger.info('Starting web server on port 8000')
  uvicorn.run(app, host='192.168.1.25', port=8000)

if __name__ == '__main__':
  main()</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of the decorator <span class="hi-blue">@app.exception_handler(HTTPException)</span> on the Python function,
        which handles any of the HTTP exception(s) raised and returns a JSON response to the client with an appropriate HTTP status
        code.</p>
    </div>
    <div id="para-div">
      <p>To execute the above Python code, execute the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ python sample_5.py</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The output would be similar to that of <span class="bold">Output.1</span> from above.</p>
    </div>
    <div id="para-div">
      <p>Open a terminal window and execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/greet</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.5</h4>
      <pre>HTTP/1.1 422 Unprocessable Entity
content-length: 90
content-type: application/json
date: Sun, 05 Oct 2025 21:34:51 GMT
server: uvicorn

{
  "detail": [
    {
      "input": null,
      "loc": [
        "query",
        "name"
      ],
      "msg": "Field required",
      "type": "missing"
    }
  ]
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the HTTP status code of <span class="hi-red">422</span> along with a JSON response above !!!</p>
    </div>
    <div id="para-div">
      <p>In the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/greet?name=Dennis</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.6</h4>
      <pre>HTTP/1.1 200 OK
content-length: 28
content-type: application/json
date: Sun, 05 Oct 2025 21:37:23 GMT
server: uvicorn

{
  "message": "Hello Dennis !"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Shifting gears, the following is our sixth <span class="bold">FastAPI</span> Python code that demonstrates how one can
        implement a REST based API service:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_6.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   28 Sep 2025
#

import logging
import uvicorn

from fastapi import FastAPI, HTTPException, status
from fastapi.exceptions import RequestValidationError
from pydantic import BaseModel, Field, EmailStr
from starlette.responses import JSONResponse
from typing import Optional

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-06')

class Contact(BaseModel):
  firstname: str = Field(min_length=1, max_length=25)
  lastname: str = Field(min_length=1, max_length=25)
  email: EmailStr = Field(min_length=10, max_length=50)
  mobile: Optional[str] | None = Field(max_length=10, pattern=r'^[1-9][0-9]+$', default=None)

address_book = {
  'ada_l@mail.com': Contact(firstname='Ada',
                            lastname='Lovelace',
                            email='ada_l@mail.com',
                            mobile='1230981000'),
  'dennis.ritchie@att.com': Contact(firstname='Dennis',
                                    lastname='Ritchie',
                                    email='dennis.ritchie@att.com'),
  'james_g@sun.com': Contact(firstname='James',
                              lastname='Gosling',
                              email='james_g@sun.com'),
}

app = FastAPI()

@app.exception_handler(RequestValidationError)
async def request_validation_error_handler(request, exc):
  logger.info('Calling request_validation_error_handler ...')
  return JSONResponse(
    status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
    content={
      'message': exc.errors(),
    })

@app.exception_handler(HTTPException)
async def http_exception_handler(request, exc):
  logger.info('Calling http_exception_handler ...')
  return JSONResponse(
    status_code=exc.status_code,
    content={
      'message': exc.detail,
    })

@app.get('/contacts')
async def all_contacts() -> list[Contact]:
  logger.info('Calling all_contacts ...')
  return address_book.values()

@app.post('/contact')
async def create_contact(contact: Contact):
  logger.info(f'Calling create_contact with {contact}')
  if contact is not None and contact.email is not None:
    address_book[contact.email] = contact
    logger.info(f'Created {contact}')
  return contact

@app.put('/contact')
async def update_contact(contact: Contact) -> Contact:
  logger.info(f'Calling update_contact with {contact}')
  if contact is not None and contact.email is not None:
    if contact.email not in address_book:
      raise HTTPException(status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
                          detail='Email not found')
    address_book[contact.email] = contact
    logger.info(f'Updated {contact}')
  return contact

@app.delete('/contact')
async def delete_contact(email: str):
  logger.info(f'Calling delete_contact with {email}')
  if email is not None:
    del address_book[email]
    logger.info(f'Deleted {email}')
  return {'email': email}

def main():
  logger.info('Starting web server on port 8000')
  uvicorn.run(app, host='192.168.1.25', port=8000)

if __name__ == '__main__':
  main()</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>Notice the use of the decorator <span class="hi-blue">@app.exception_handler(RequestValidationError)</span> on the Python
        function, which handles any of the exception(s) raised due to invalid request and returns a JSON response to the client with
        an appropriate HTTP status code.</p>
    </div>
    <div id="para-div">
      <p>To execute the above Python code, execute the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ python sample_6.py</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The output would be similar to that of <span class="bold">Output.1</span> from above.</p>
    </div>
    <div id="para-div">
      <p>Open a terminal window and execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/contacts</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.7</h4>
      <pre>HTTP/1.1 200 OK
content-length: 264
content-type: application/json
date: Sun, 05 Oct 2025 21:48:05 GMT
server: uvicorn

[
  {
    "email": "ada_l@mail.com",
    "firstname": "Ada",
    "lastname": "Lovelace",
    "mobile": "1230981000"
  },
  {
    "email": "dennis.ritchie@att.com",
    "firstname": "Dennis",
    "lastname": "Ritchie",
    "mobile": null
  },
  {
    "email": "james_g@sun.com",
    "firstname": "James",
    "lastname": "Gosling",
    "mobile": null
  }
]</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>In the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ echo '{"firstname": "Guido Van", "lastname": "Rossum", "email": "guido_van_rossum@python.org", "mobile": "2348762000"}' | http POST http://192.168.1.25:8000/contact</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.8</h4>
      <pre>HTTP/1.1 200 OK
content-length: 105
content-type: application/json
date: Sun, 05 Oct 2025 21:49:46 GMT
server: uvicorn

{
  "email": "guido_van_rossum@python.org",
  "firstname": "Guido Van",
  "lastname": "Rossum",
  "mobile": "2348762000"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Once again, in the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ echo '{"firstname": "James", "lastname": "Gosling", "email": "james_g.sun.com", "mobile": "3457653000"}' | http PUT http://192.168.1.25:8000/contact</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.9</h4>
      <pre>HTTP/1.1 422 Unprocessable Entity
content-length: 224
content-type: application/json
date: Sun, 05 Oct 2025 21:55:38 GMT
server: uvicorn

{
  "message": [
    {
      "ctx": {
        "reason": "An email address must have an @-sign."
      },
      "input": "james_g.sun.com",
      "loc": [
        "body",
        "email"
      ],
      "msg": "value is not a valid email address: An email address must have an @-sign.",
      "type": "value_error"
    }
  ]
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>One more time, in the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ echo '{"firstname": "James", "lastname": "Gosling", "email": "james_g@sun.com", "mobile": "3457653000"}' | http PUT http://192.168.1.25:8000/contact</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.10</h4>
      <pre>HTTP/1.1 200 OK
content-length: 90
content-type: application/json
date: Sun, 05 Oct 2025 21:56:52 GMT
server: uvicorn

{
  "email": "james_g@sun.com",
  "firstname": "James",
  "lastname": "Gosling",
  "mobile": "3457653000"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>One more time, in the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/contacts</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.11</h4>
      <pre>HTTP/1.1 200 OK
content-length: 378
content-type: application/json
date: Sun, 05 Oct 2025 21:57:59 GMT
server: uvicorn

[
  {
    "email": "ada_l@mail.com",
    "firstname": "Ada",
    "lastname": "Lovelace",
    "mobile": "1230981000"
  },
  {
    "email": "dennis.ritchie@att.com",
    "firstname": "Dennis",
    "lastname": "Ritchie",
    "mobile": null
  },
  {
    "email": "james_g@sun.com",
    "firstname": "James",
    "lastname": "Gosling",
    "mobile": "3457653000"
  },
  {
    "email": "guido_van_rossum@python.org",
    "firstname": "Guido Van",
    "lastname": "Rossum",
    "mobile": "2348762000"
  }
]</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Again, in the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http DELETE http://192.168.1.25:8000/contact?email='guido_van_rossum@python.org'</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.12</h4>
      <pre>HTTP/1.1 200 OK
content-length: 39
content-type: application/json
date: Mon, 06 Oct 2025 00:21:10 GMT
server: uvicorn

{
  "email": "guido_van_rossum@python.org"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>One last time, in the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http GET http://192.168.1.25:8000/contacts</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.13</h4>
      <pre>HTTP/1.1 200 OK
content-length: 272
content-type: application/json
date: Mon, 06 Oct 2025 00:21:55 GMT
server: uvicorn

[
  {
    "email": "ada_l@mail.com",
    "firstname": "Ada",
    "lastname": "Lovelace",
    "mobile": "1230981000"
  },
  {
    "email": "dennis.ritchie@att.com",
    "firstname": "Dennis",
    "lastname": "Ritchie",
    "mobile": null
  },
  {
    "email": "james_g@sun.com",
    "firstname": "James",
    "lastname": "Gosling",
    "mobile": "3457653000"
  }
]</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Next on, the following is our seventh <span class="bold">FastAPI</span> Python code that demonstrates how one can protect
        a REST based API service endpoint using a JWT token:</p>
    </div>
    <br/>
    <div id="src-outer-div-1">
      <div class="src-cap-1">sample_7.py</div>
      <div class="gen-src-body">
<pre>#
# @Author: Bhaskar S
# @Blog:   https://polarsparc.github.io
# @Date:   04 Oct 2025
#

import logging
import os
import uvicorn

from datetime import datetime, timezone, timedelta
from dotenv import load_dotenv, find_dotenv
from fastapi import FastAPI, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from jose import jwt, JWTError
from pydantic import BaseModel

logging.basicConfig(format='%(levelname)s %(asctime)s - %(message)s',
                    level=logging.INFO)

logger = logging.getLogger('sample-07')

class Credentials(BaseModel):
  username: str
  password: str

class JoseJwtManager(object):
  def __init__(self):
    load_dotenv(find_dotenv())
    self.jwt_secret_key = os.getenv('JWT_SECRET_KEY')
    self.jwt_algorithm = os.getenv('JWT_ALGORITHM')
    self.jwt_expiration_secs = int(os.getenv('JWT_EXPIRATION_SECS'))

  def expiry_time_secs(self):
    """This method returns the expiration time."""
    return self.jwt_expiration_secs

  def create_token(self, subject: str) -> str:
    """This method creates a new JWT token."""
    logger.info(f'Creating JWT token for subject {subject}')
    now = datetime.now(timezone.utc)
    payload = {
      'sub': subject,
      'iat': int(now.timestamp()),
      'exp': int((now + timedelta(seconds=self.jwt_expiration_secs)).timestamp()),
      'iss': 'polarsparc.com',
    }
    return jwt.encode(payload, self.jwt_secret_key, algorithm=self.jwt_algorithm)

  def verify_token(self, token: str) -> str:
    """This method verifies a JWT token."""
    logger.info(f'Verifying JWT token')
    subject = None
    try:
      payload = jwt.decode(token, self.jwt_secret_key, algorithms=[self.jwt_algorithm])
      subject = payload.get('sub')
    except JWTError as e:
      logger.error(f'JWT error: {e}')
    return subject

oauth2_scheme = OAuth2PasswordBearer(tokenUrl='token')
jwt_manager = JoseJwtManager()

async def get_subject(token: str = Depends(oauth2_scheme)):
  subject = jwt_manager.verify_token(token)
  if subject is None:
    raise HTTPException(
      status_code=status.HTTP_401_UNAUTHORIZED,
      detail='Could not validate token credentials',
      headers={'WWW-Authenticate': 'Bearer'},
    )
  return {'subject': subject}

app = FastAPI()

@app.post('/token')
async def login(credentials: Credentials):
  logger.info(f'Username: {credentials.username}')
  user_credentials = {
    'ada_l@mail.com': 'Ada.S3cr3t',
    'dennis.ritchie@att.com': 'Dennis.C0d3',
    'james_g@sun.com': 'James.P4ss',
  }
  if credentials.username in user_credentials:
    secret = user_credentials[credentials.username]
    if credentials.password == secret:
      token = jwt_manager.create_token(credentials.username)
      return {'access_token': token, 'token_type': 'bearer'}
  raise HTTPException(
    status_code=status.HTTP_401_UNAUTHORIZED,
    detail='Incorrect username or password',
    headers={'WWW-Authenticate': 'Bearer'},
  )

@app.get('/greet')
async def greet():
  return {'message': f'Howdy buddy, welcome to the unrestricted zone !!!'}

@app.get('/protected/greet')
async def protected_greet(payload: dict = Depends(get_subject)):
  return {'message': f'Howdy {payload['subject']}, welcome to the protect zone !!!'}

def main():
  logger.info('Starting web server on port 8000')
  uvicorn.run(app, host='192.168.1.25', port=8000)

if __name__ == '__main__':
  main()</pre>
      </div>
    </div>
    <br/>
    <div id="para-div">
      <p>To execute the above Python code, execute the following command in a terminal window:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ python sample_7.py</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The output would be similar to that of <span class="bold">Output.1</span> from above.</p>
    </div>
    <div id="para-div">
      <p>Open a terminal window and execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ echo '{"username": "James", "password": "dog"}' | http POST http://192.168.1.25:8000/token</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.14</h4>
      <pre>HTTP/1.1 401 Unauthorized
content-length: 43
content-type: application/json
date: Mon, 06 Oct 2025 00:46:39 GMT
server: uvicorn
www-authenticate: Bearer

{
  "detail": "Incorrect username or password"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>In the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ echo '{"username": "james_g@sun.com", "password": "James.P4ss"}' | http POST http://192.168.1.25:8000/token</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.15</h4>
      <pre>HTTP/1.1 200 OK
content-length: 232
content-type: application/json
date: Mon, 06 Oct 2025 00:48:24 GMT
server: uvicorn

{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJqYW1lc19nQHN1bi5jb20iLCJpYXQiOjE3NTk3MTE3MDUsImV4cCI6MTc1OTcxMTc5NSwiaXNzIjoicG9sYXJzcGFyYy5jb20ifQ.NOnNlv8i20_IEPSMOMEi7WjD1xngRblX2R6FEuDKXok",
  "token_type": "bearer"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Using the access token from above, in the same terminal window, now execute the following command:</p>
    </div>
    <br/>
    <div id="cmd-div">
      <p>$ http -A bearer -a "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJqYW1lc19nQHN1bi5jb20iLCJpYXQiOjE3NTk3MTE3MDUsImV4cCI6MTc1OTcxMTc5NSwiaXNzIjoicG9sYXJzcGFyYy5jb20ifQ.NOnNlv8i20_IEPSMOMEi7WjD1xngRblX2R6FEuDKXok" http://192.168.1.25:8000/protected/greet</p>
    </div>
    <br/>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.16</h4>
      <pre>HTTP/1.1 200 OK
content-length: 68
content-type: application/json
date: Mon, 06 Oct 2025 00:49:02 GMT
server: uvicorn

{
  "message": "Howdy james_g@sun.com, welcome to the protect zone !!!"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>Wait a few seconds and retry the above command in the same terminal window one more time.</p>
    </div>
    <div id="para-div">
      <p>The following would be the typical output:</p>
    </div>
    <br/>
    <div id="out-div">
      <h4>Output.17</h4>
      <pre>HTTP/1.1 401 Unauthorized
content-length: 49
content-type: application/json
date: Mon, 06 Oct 2025 00:52:46 GMT
server: uvicorn
www-authenticate: Bearer

{
  "detail": "Could not validate token credentials"
}</pre>
    </div>
    <br/>
    <div id="para-div">
      <p>With this, we conclude the various demonstrations on using the <span class="bold">FastAPI</span> web framework for building
        and deploying REST based API services !!!</p>
    </div>
    <br/>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://fastapi.tiangolo.com/" target="_blank"><span class="bold">FastAPI Web Framework</span></a></p>
    </div>
    <br/>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
