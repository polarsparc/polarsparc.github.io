<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=windows-1252" />
    <meta name="author" content="Bhaskar.S">
    <meta name="description" content="Introduction to Bluetooth Low Energy (BLE)">
    <meta name="subject" content="Introduction to Bluetooth Low Energy (BLE)">
    <meta name="keywords" content="ble, iot">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <title>Introduction to Bluetooth Low Energy (BLE)</title>
    <link href="../css/polarsparc-v2.4.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <br/>
    <table borber="0">
      <tr>
        <td valign="bottom"><span id="ps-home"></span></td>
        <td valign="bottom"><span id="home-a"><a id="home-a" href="https://polarsparc.github.io/">PolarSPARC</a></span></td>
      </tr>
    </table>
    <br/>
    <div id="title-div">
      <p>Introduction to Bluetooth Low Energy (BLE)</p>
    </div>
    <br/>
    <table id="ad-table">
      <tbody>
        <tr>
          <td class="author-td">Bhaskar S</td>
          <td class="date-td">11/26/2022</td>
        </tr>
      </tbody>
    </table>
    <hr class="line-hr" />
    <br/>
    <div id="step-div">
      <p>Overview</p>
    </div>
    <div id="para-div">
      <p><span class="hi-yellow">Bluetooth Low Energy</span> (or <span class="hi-yellow">BLE</span> for short) standard was added to
        the Bluetooth Core Specification in version 4.0. Bluetooth Low Energy, as the name indicates, is a short-range, interoperable,
        wireless connectivity standard for small battery-operated devices with low power consumption and intermittent data transfer
        needs. This standard is different from the core <span class="hi-yellow">Bluetooth Classic</span> standard, which is commonly
        used for connectivity of higher bandwidth needs, such as the headphones, speakers, smartphones, laptops, etc.</p>
      <p>BLE uses the 2.4 GHz Industrial Scientific Medical (ISM) frequency radio spectrum since it has no licensing requirements.
        However, the 2.4 GHz radio spectrum has some challenges relating to poor propagation charateristics due to absorption of the
        radio signals by some elements like water.</p>
      <p>The BLE radio spectrum is divided into 40 frequency channels, each of 2 Mhz frequency. The maximum supported data transfer
        rate is in the range 1 Mbps to 2 Mbps. Also, the maximum support distance (range) is between 30 feet to 100 feet.</p>
    </div>
    <div id="step-div">
      <p>Architecture Stack</p>
    </div>
    <div id="para-div">
      <p>The following illustration shows the high-level architecture of BLE:</p>
    </div>
    <br/>
    <div id="img-outer-div">
      <img src="./images/ble-1.png" class="img-cls" alt="BLE Architecture" />
      <div class="img-cap">Figure-1</div>
    </div>
    <br/>
    <div id="para-div">
      <p>The architecture stack is divided into thre core layers which are as follows:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="hi-yellow">Controller</span> :: the physical hardware that operates at the ISM band and is responsible
            for the actual transmit and/or receive of the radio signals through the 40 radio frequency channels</p>
        </li>
        <li>
          <p><span class="hi-yellow">Host</span> :: the software layer that interfaces with the Controller and is responsible for
            how two or more devices communicate with one another</p>
        </li>
        <li>
          <p><span class="hi-yellow">Application</span>(s) :: the software layer that enables developers to build applications to
            tackle specific use-cases</p>
        </li>
      </ul>
    </div>
    <div id="para-div">
      <p>We will delve a little more into the different layers of the architectural stack as follows:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="hi-yellow">Physical Layer</span> :: the hardware layer that is responsible for transmitting and receiving
            bits as electromagnetic radio waves using the 2.4 GHz ISM frequency band that is split into 40 separate radio frequency
            channels, each 2 MHz apart from one another</p>
          <div id="para-div">
            <p>The following illustration shows the BLE 40 radio frequency channels:</p>
          </div>
          <br/>
          <div id="img-outer-div">
            <img src="./images/ble-2.png" class="img-cls" alt="BLE Spectrum" />
            <div class="img-cap">Figure-2</div>
          </div>
          <br/>
          <p>The three channels 37, 38, and 39 are referred to as the <span class="hi-blue">Primary Advertising Channels</span> and
            the remaning channels 0 through 36 are referred to as the <span class="hi-blue">Secondary Advertising Channels</span></p>
        </li>
        <li>
          <p><span class="hi-yellow">Link Layer</span> :: is the most complex part of the architecture stack and the is responsible
            for advertising, scanning, creating and maintaining connections. It defines the data packet formats for transmission,
            bit stream processing, and error checking.</p>
          <p>This layer provides support for both connectionless and connection-oriented communication.</p>
          <p>Every BLE device has an associated <span class="hi-blue">48-bit</span> device address, which is similar to a MAC address.</p>
          <p>Any BLE device can operate in one of the following states:</p>
          <ul id="blue-sqr-ul">
            <li><p><span class="hi-blue">Standby</span> :: the default state in which no data is either transmitted or received</p></li>
            <li><p><span class="hi-blue">Advertising</span> :: a device sends out advertising packets for other devices to discover it</p></li>
            <li><p><span class="hi-blue">Scanning</span> :: a device scans for other dvices that are sending out advertising packets</p></li>
            <li><p><span class="hi-blue">Initiating</span> :: a scanning device decides to establish a connection with a device that is
              sending out advertising packets</p></li>
            <li><p><span class="hi-blue">Connected</span> :: a device has established a connection with another device and is exchanging
              data at regular intervals</p></li>
          </ul>
          <p>The device that initiates and establishes a connection is called the <span class="hi-blue">Master</span> and the device
            that was sending out advertising packets is called the <span class="hi-blue">Slave</span></p>
        </li>
        <li>
          <p><span class="hi-yellow">Host Controller Interface</span> :: allows for communication between the Host and the Controller
            using well-defined functional interfaces. It allows a Host to send commands and data to the Controller and the Controller
            to send events and data to the Host</p>
        </li>
        <li>
          <p><span class="hi-yellow">Logical Link Control and Adaptation Protocol</span> :: is responsible for channel multiplexing,
            flow control, and data packet segmentation/reassembly</p>
        </li>
        <li>
          <p><span class="hi-yellow">Security Manager Protocol</span> :: manages all the security aspects of a device and is responsible
            for the following aspects:</p>
          <ul id="blue-sqr-ul">
            <li><p><span class="hi-blue">Pairing</span> :: the process of generating a shared secret key between two devices</p></li>
            <li><p><span class="hi-blue">Bonding</span> :: the process of storing the generated shared key on both sides of the two
              communicating devices</p></li>
            <li><p><span class="hi-blue">Authentication</span> :: the process of verifying the two communicating devices share the same
              secret key</p></li>
            <li><p><span class="hi-blue">Encryption</span> :: the process of encrypting the data exchanged between the two communicating
              devices using the shared secret key</p></li>
            <li><p><span class="hi-blue">Data Integrity</span> :: the process of ensuring data has not been altered or corrupted during
              the data exchange</p></li>
          </ul>
        </li>
        <li>
          <p><span class="hi-yellow">Attribute Protocol</span> :: <span class="hi-blue">ATT</span> for short, it defines how data
            elements (referred to as the <span class="hi-blue">Attributes</span>) are structured and exchanged between two communicating
            devices, with one device acting as a client and the other as a server.</p>
          <p>The device that exposes the set of data elements is known the <span class="hi-grey">Server</span>, while the device that
            connects to the Server for the purposes of reading the exposed data or for controlling the behavior of the Server is known
            as the <span class="hi-grey">Client</span>.</p>
          <p>Every Attribute is made up of the following items:</p>
          <ul id="blue-sqr-ul">
            <li><p><span class="hi-blue">Attribute Type</span> :: a <span class="hi-grey">16-bit</span> industry assigned, pre-defined
              UUID, such as battery level, latitude, longitude, temperature, etc. It is a <span class="hi-grey">128-bit</span> UUID for
              non-standard, custom types</p></li>
            <li><p><span class="hi-blue">Attribute Handle</span> :: a <span class="hi-grey">16-bit</span> identifier assigned by the
              Server and used by the Client to reference that Attribute</p></li>
            <li><p><span class="hi-blue">Attribute Value</span> :: a variable length Attribute value</p></li>
            <li><p><span class="hi-blue">Attribute Permissions</span> :: the permissions associated with the Attribute to determine
              if that Attribute can be read or written to</p></li>
          </ul>
        </li>
        <li>
          <p><span class="hi-yellow">Generic Attribute Profile</span> :: <span class="hi-blue">GATT</span> for short, is a higher level
            abstraction over Attributes and is used to define generic functionality, which encompasses the following core concepts:</p>
          <ul id="blue-sqr-ul">
            <li><p><span class="hi-blue">Profile</span> :: a well-defined set of functional procedures that define how two devices can
              connect with each other to discover and use functionality. They are an embodiment of a use-case</p></li>
            <li><p><span class="hi-blue">Characteristic</span> :: represents a data Attribute, along with some metadata information
              (referred to as the <span class="hi-grey">Descriptor</span>)</p></li>
            <li><p><span class="hi-blue">Service</span> :: a collection of one or more related Attributes and Characteristics that
              support a particular functionality on the Server device. For example, a Location service includes the Attributes related
              to the Latitude and Longitude. They are akin to standard services in the TCP world such as SMTP, SSH, etc.</p>
              <p>Just like the Attribute, each industry defined Service (such has Battery Level Service) has a <span class="hi-grey">
                16-bit</span> pre-defined UUID OR a <span class="hi-grey">128-bit</span> UUID for non-standard, custom Services</p></li>
          </ul>
        </li>
        <li>
          <p><span class="hi-yellow">Generic Access Profile</span> :: defines a standard framework and procedures related to device
            discovery and establishment of connections between two devices. The implementation of the standard framework is what enables
            how two devices discovery, connect, and communicate with one another to exchange data. This layer defines the different
            roles a device can play which are as follows:</p>
          <ul>
            <li><p><span class="hi-blue">Broadcaster</span> :: a device that only contains a transmitter and periodically broadcasts
              advertising data packets in a connectionless manner. It does not allow any connection from another device</p></li>
            <li><p><span class="hi-blue">Observer</span> :: a device that only contains a receiver and is able to discovers devices by
              receiving advertising data packets in a conecctionless manner. It does not have the capability to initiate a connection
              with the advertiser</p></li>
            <li><p><span class="hi-blue">Peripheral</span> :: a device that contains both the transmitter and receiver and announces
              its presence by broadcasting advertising packets. It is able to accept a connection from another device</p></li>
            <li><p><span class="hi-blue">Central</span> :: a device with both the transmitter and receiver that is able to discover
              and listen to other devices that are sending advertising data packets. It is also capable of establishing a connection
              with the Peripherals</p></li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="step-div">
      <p>BLE Packet</p>
    </div>
    <div id="para-div">
      <p>Every BLE packet has the following format:</p>
    </div>
    <br/>
    <div id="img-outer-div">
      <img src="./images/ble-3.png" class="img-cls" alt="BLE Packet" />
      <div class="img-cap">Figure-3</div>
    </div>
    <br/>
    <div id="para-div">
      <p>The fields in the BLE packet are described as follows:</p>
      <ul id="blue-sqr-ul">
        <li>
          <p><span class="hi-yellow">Preamble</span> :: the first bit are always set to either <span class="hi-blue">01010101</span>
            or <span class="hi-blue">10101010</span>. This is so that the receiver can synchronize and determine the frequencies for
            a <span class="hi-grey">0</span> and a <span class="hi-grey">1</span>. The Advertising packet always use <span class="bold">
            10101010</span>, while the data packets use <span class="bold">10101010</span> if least significant bit of Access Address
            is a 0 and <span class="bold">01010101</span> if least significant bit of Access Address is a 1</p>
        </li>
        <li>
          <p><span class="hi-yellow">Access Address</span> :: they are of two types - <span class="hi-blue">Advertising Access Address</span>
            or <span class="hi-blue">Data Access Address</span>. The Advertising Access Address in all advertising packets use a fixed
            value of <span class="hi-grey">0x8E89BED6</span>. For Data Access Address in the data packets, it consists of 32 bit random
            value (which follow specifc rules) generated by BLE device in Initiating state. The same value of the Data Access Address
            is used once a connection is established and helps in correlation of data packets</p>
        </li>
        <li>
          <p><span class="hi-yellow">Header</span>(s) :: the header is further broken down as follows:</p>
          <br/>
          <div id="img-outer-div">
            <img src="./images/ble-4.png" class="img-cls" alt="BLE Header" />
            <div class="img-cap">Figure-4</div>
          </div>
          <br/>
          <p>The <span class="hi-blue">Packet Type</span> is the most important and can have values as follows:</p>
          <table id="col3-table">
            <thead>
              <tr>
                <th>Type Value</th>
                <th>Flag</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="col3-c1-odd">0000</td>
                <td class="col3-c2-odd">ADV_IND</td>
                <td class="col3-c3-odd">Connectable undirected</td>
              </tr>
              <tr>
                <td class="col3-c1-even">0001</td>
                <td class="col3-c2-even">ADV_DIRECT_IND</td>
                <td class="col3-c3-even">Connectable directed</td>
              </tr>
              <tr>
                <td class="col3-c1-odd">0010</td>
                <td class="col3-c2-odd">ADV_NONCONN_IND</td>
                <td class="col3-c3-odd">Non-connectable undirected</td>
              </tr>
              <tr>
                <td class="col3-c1-even">0011</td>
                <td class="col3-c2-even">SCAN_REQ</td>
                <td class="col3-c3-even">Active scanning request</td>
              </tr>
              <tr>
                <td class="col3-c1-odd">0100</td>
                <td class="col3-c2-odd">SCAN_RSP</td>
                <td class="col3-c3-odd">Active scanning response</td>
              </tr>
              <tr>
                <td class="col3-c1-even">0101</td>
                <td class="col3-c2-even">CONNECT_REQ</td>
                <td class="col3-c3-even">Connection request</td>
              </tr>
              <tr>
                <td class="col3-c1-odd">0110</td>
                <td class="col3-c2-odd">ADV_SCAN_IND</td>
                <td class="col3-c3-odd">Scannable undirected</td>
              </tr>
            </tbody>
          </table>
          <p>For <span class="hi-blue">Tx Addr Type</span> and <span class="hi-blue">Rx Addr Type</span>, a value of
            <span class="hi-grey">0</span> means public address (assigned by the Bluetooth organization) and a value of
            <span class="hi-grey">1</span> means random private address</p>
        </li>
        <li>
          <p><span class="hi-yellow">Length</span>(s) :: for advertising packets, the length field is 6 bits in size with valid values
            from <span class="hi-blue">6</span> through <span class="hi-blue">37</span>. For data packets, on the other hand the length
            field is 5 bits in size with valid values from <span class="hi-blue">0</span> through <span class="hi-blue">31</span></p>
        </li>
        <li>
          <p><span class="hi-yellow">Payload</span>(s) :: the actual data (be it advertising or service) being transmitted</p>
        </li>
        <li>
          <p><span class="hi-yellow">CRC</span>(s) :: used for error checking and is calculated over the Header, the Length, and
            the Payload fields</p>
        </li>
      </ul>
    </div>
    <div id="step-div">
      <p>High-Level Functionality</p>
    </div>
    <div id="para-div">
      <p>In the Advertising state, a device transmits advertising packets containing some relevant and useful information, such as
        the local name of the device, whether another device can connect to this device, a list of Service UUIDs supported by this
        device, etc.</p>
      <p>As was indicated above in Figure.2, there are three Primary Advertising channels - 36, 37, and 38 that a device will start
        advertising on them. The size of the advertising data is limited to about 31 bytes.</p>
      <p>Note that only a Broadcaster or a Peripheral can transmit advertising packets.</p>
      <p>An advertising packet can be one of several types, which are as follows:</p>
      <ul>
        <li><p><span class="hi-blue">Connectable and Scannable Undirected</span> :: allows other devices to receive the advertising
          packets, send a scan request to the advertising device, and establish a connection with the advertising device</p></li>
        <li><p><span class="hi-blue">Connectable Undirected</span> :: allows other devices to receive the advertising packets and
          establish a connection with the advertising device</p></li>
        <li><p><span class="hi-blue">Connectable Directed</span> :: allows a SPECIFIC device to receive the advertising packets and
          establish a connection with the advertising device</p></li>
        <li><p><span class="hi-blue">Non-Connectable and Non-Scannable Undirected</span> :: allows other devices to ONLY receive
          the advertising packets</p></li>
        <li><p><span class="hi-blue">Non-Connectable and Non-Scannable Directed</span> :: allows a SPECIFIC device to ONLY receive
          the advertising packets</p></li>
        <li><p><span class="hi-blue">Scannable Undirected</span> :: allows other devices to send a scan request to the advertising
          device to receive additional data</p></li>
        <li><p><span class="hi-blue">Scannable Directed</span> :: allows a SPECIFIC device to send a scan request to the advertising
          device to receive additional data</p></li>
      </ul>
      <p>A typical <span class="hi-blue">Advertising Interval</span> is in the range of <span class="hi-grey">20 ms</span> to a
        maximum of <span class="hi-grey">10 sec</span>.</p>
    </div>
    <div id="para-div">
      <p>In order to receive the advertising packets, a device needs to tune into the three Primary Advertising channels one at a
        time. A device that listens for advertisements and then sends scan requests to the advertising device is said to be in a
        <span class="hi-blue">Active Scanning Mode</span>. On the other hand, if the listening device does NOT send any scan requests
        to the advertising device, then it is said to be in <span class="hi-blue">Passive Scanning Mode</span>.</p>
      <p>Note that only a Central can transmit scan request packets.</p>
    </div>
    <div id="para-div">
      <p>A connection between two devices can happen when one device is a Peripheral and the other device is a Central. In order to
        make a connection, a Peripheral device needs to transmit connectable advertising packets. A Central device must be scanning
        for these connectable advertising packets on the thre Primary Advertising channels. Once a Central device reads a connectable
        advertising packet, it can initiate a connection request to the advertising Peripheral. Once a connection is established
        between a Peripheral and a Central, the Peripheral can receives requests for a Service and the Peripheral can send a response
        related to the Service back to the Central using the Secondary Adevertising channels.</p>
    </div>
    <div id="para-div">
      <p>The following illustration depicts the interaction flow between a Peripheral and a Central:</p>
    </div>
    <br/>
    <div id="img-outer-div">
      <img src="./images/ble-5.png" class="img-cls" alt="Interaction Flo0w" />
      <div class="img-cap">Figure-5</div>
    </div>
    <br/>
    <div id="section-div">
      <p>References</p>
    </div>
    <div id="para-div">
      <p><a href="https://www.bluetooth.com/bluetooth-resources/intro-to-bluetooth-low-energy/" target="_blank"><span class="bold">Official Bluetooth Low Energy Resources</span></a></p>
    </div>
    <br/>
    <hr class="line-hr" />
    <div>
      <a id="footer-a" href="https://polarsparc.github.io/">&copy;&nbsp;PolarSPARC</a>
    </div>
  </body>
</html>
